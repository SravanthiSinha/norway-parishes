{"version":3,"file":"previewCIMSymbol-C3BxB8cn.js","sources":["../../node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js","../../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import{OverrideHelper as a}from\"./OverrideHelper.js\";import{mapCIMSymbolToGeometryType as s}from\"./utils.js\";const n=96/72;class h{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,h,l,c,m,g){if(!e)return null;const{data:y}=e;if(!y||\"CIMSymbolReference\"!==y.type||!y.symbol)return null;const{symbol:d}=y;l||(l=s(d));const u=await a.resolveSymbolOverrides(y,t,this._spatialReference,h,l,c,m),w=this._cimResourceManager,p=[];r.fetchResources(u,w,p),r.fetchFonts(u,w,p),p.length>0&&await Promise.all(p);const{width:b,height:f}=i,M=o(l,b,f,n),C=r.getEnvelope(u,M,w);if(!C)return null;C.x===1/0&&(C.x=b+2),C.y===1/0&&(C.y=-f/2),C.width===-1/0&&(C.width=b),C.height===-1/0&&(C.height=f);let R=1,v=0,x=0;switch(d.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>f&&(t=f/C.height),\"preview\"===n&&(C.width<b&&(e=b/C.width),C.height<f&&(t=f/C.height)),R=Math.min(e,t),v=C.x+C.width/2,x=C.y+C.height/2}break;case\"CIMLineSymbol\":{(g||C.height>f)&&(R=f/C.height),x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,{paths:i}=M;i[0][0][0]-=e/R,i[0][2][0]-=(t-b)/R}break;case\"CIMPolygonSymbol\":{v=C.x+C.width/2,x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,i=C.y*R+f/2,r=(C.y+C.height)*R+f/2,{rings:a}=M;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>b&&(a[0][1][0]-=t-b,a[0][2][0]-=t-b),r>f&&(a[0][2][1]+=r-f,a[0][3][1]+=r-f)}}const I={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:u}};return this.rasterize(I,b,f,v,x,R,l,1,M)}rasterize(e,r,a,h,l,c,m,g=0,y=null){const{data:d}=e;if(!d||\"CIMSymbolReference\"!==d.type||!d.symbol)return null;const{symbol:u}=d,w=this._canvas,p=(window.devicePixelRatio||1)*n;w.width=r*p,w.height=a*p,m||(m=s(u)),y||(y=o(m,r,a,\"legend\")),w.width+=2*g,w.height+=2*g;const b=w.getContext(\"2d\",{willReadFrequently:!0}),f=t.createIdentity();f.translate(-h,-l),f.scale(c*p,-c*p),f.translate(r*p/2+g,a*p/2+g),b.clearRect(0,0,w.width,w.height);return new i(b,this._cimResourceManager,f,!0).drawSymbol(u,y),b.getImageData(0,0,w.width,w.height)}}function o(e,t,i,r){const a=1,s=-t/2+a,n=t/2-a,h=i/2-a,o=-i/2+a;switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[n,0]]]};default:return\"legend\"===r?{rings:[[[s,h],[n,0],[n,o],[s,o],[s,h]]]}:{rings:[[[s,h],[n,h],[n,o],[s,o],[s,h]]]}}}export{h as CIMSymbolRasterizer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as r}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as n}from\"../cim/utils.js\";import{SymbolSizeDefaults as a}from\"./previewUtils.js\";import{renderSymbol as o}from\"./renderUtils.js\";const s=new l(null),c=e(a.size),m=e(a.maxSize),u=e(a.lineWidth),f=1;async function h(e,t,i){const l=t?.size;let r=null!=l&&\"object\"==typeof l&&\"width\"in l?l.width:l,n=null!=l&&\"object\"==typeof l&&\"height\"in l?l.height:l;if(null==r||null==n)if(\"esriGeometryPolygon\"===i)r=c,n=c;else{const l=await y(e,t,i);l&&(r=l.width,n=l.height),\"esriGeometryPolyline\"===i&&(r=u),r=null!=r&&isFinite(r)?Math.min(r,m):c,n=null!=n&&isFinite(n)?Math.max(Math.min(n,m),f):c}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(r=u),{width:r,height:n}}async function y(e,t,l){const{feature:n,fieldMap:a,viewParams:o}=t.cimOptions||t,c=await r.resolveSymbolOverrides(e.data,n,null,a,l,null,o);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const m=[];return i.fetchResources(c,s.resourceManager,m),i.fetchFonts(c,s.resourceManager,m),m.length>0&&await Promise.all(m),i.getEnvelope(c,null,s.resourceManager)}async function p(e,i={}){const{node:l,opacity:r,symbolConfig:a}=i,c=null!=a&&\"object\"==typeof a&&\"isSquareFill\"in a&&a.isSquareFill,m=i.cimOptions||i,u=m.geometryType||n(e?.data?.symbol),f=await h(e,i,u),{feature:y,fieldMap:p}=m,d=c||\"esriGeometryPolygon\"!==u?\"preview\":\"legend\",g=await s.rasterizeCIMSymbolAsync(e,y,f,d,p,u,null,m.viewParams,m.allowScalingUp);if(!g)return null;const{width:w,height:b}=g,v=document.createElement(\"canvas\");v.width=w,v.height=b;v.getContext(\"2d\").putImageData(g,0,0);const M=t(f.width),j=t(f.height),S=new Image(M,j);S.src=v.toDataURL(),S.ariaLabel=i.ariaLabel??null,S.alt=i.ariaLabel??\"\",null!=r&&(S.style.opacity=`${r}`);let C=S;if(null!=i.effectView){const e={shape:{type:\"image\",x:0,y:0,width:M,height:j,src:S.src},fill:null,stroke:null,offset:[0,0]};C=o([[e]],[M,j],{effectView:i.effectView,ariaLabel:i.ariaLabel})}return l&&C&&l.appendChild(C),C}export{p as previewCIMSymbol};\n"],"names":["n","t","e","i","h","l","c","m","g","y","d","s","u","a","w","p","r","b","f","o","C","R","v","x","I","_a","M","j","S"],"mappings":"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","x_google_ignoreList":[0,1]}