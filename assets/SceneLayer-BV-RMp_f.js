const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/loadGLTFMesh-Cw-6WX7w.js","assets/index-D2fbPmv2.js","assets/index-Jib82o7I.css","assets/mat3-CrHuGM2_.js","assets/mat3f64-q3fE-ZOt.js","assets/MeshVertexAttributes-DUfgEic7.js","assets/meshVertexSpaceUtils-CCZ2kj4M.js","assets/vec32-wKfHB3TO.js","assets/MeshLocalVertexSpace-DwlLUecc.js","assets/BufferView-DMAu5AO2.js","assets/vec3-DECf-4Ts.js","assets/vec4-D4ERPKxJ.js","assets/types-D0PSWh4d.js","assets/loader-DzhMfTs_.js","assets/mat4f64-CSKppSlJ.js","assets/enums-Dk3osxpS.js","assets/quat-DicJuC4T.js","assets/quatf64-aQ5IuZRd.js","assets/resourceUtils-BNmn3taR.js","assets/basicInterfaces-CZwQPxTp.js","assets/DefaultMaterial_COLOR_GAMMA-D_bCyFuP.js","assets/Indices-CsOOuhq-.js","assets/vertexSpaceConversion-Cv5gEIZM.js","assets/spatialReferenceEllipsoidUtils-MKxqvfid.js","assets/computeTranslationToOriginAndRotation-Bz1fa-AB.js","assets/projectPointToVector-AEutsyFW.js","assets/MultiOriginJSONSupport-CiWwiGwF.js","assets/MeshTransform-B6vBmBoS.js","assets/imageUtils-ywQwDfd6.js","assets/earcut-Lltz9D9k.js","assets/plane-BL9TfL1Z.js","assets/deduplicate-p8eokHVd.js","assets/External-DYcXdrPy.js","assets/infoFor3D-CxdEiWhp.js","assets/meshSpatialReferenceScaleUtils-DD90M-OP.js","assets/APIKeyMixin-CajJ21HV.js","assets/ArcGISService-CaAm5zrR.js","assets/CustomParametersMixin-BL7lOS1M.js","assets/EditBusLayer-FZrvniEK.js","assets/uuid-Cl5lrJ4c.js","assets/OperationalLayer-OfS7ofUf.js","assets/commonProperties-ChaS5GS0.js","assets/PortalLayer-CvjKt5oM.js","assets/portalItemUtils-CSjrXciv.js","assets/SceneService-yhJDbsjz.js","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/HeightModelInfo-CjsnL3DZ.js","assets/jsonContext-BypIdMOa.js","assets/resourceUtils-DOldvmld.js","assets/resourceUtils-D1dyHKOI.js","assets/saveUtils-BnpW_vfG.js","assets/TemporalLayer-DsJdvu2C.js","assets/TimeInfo-L4LVijOt.js","assets/associatedFeatureServiceUtils-CXn7FUO4.js","assets/capabilities-Y9lFlGVh.js","assets/featureLayerUtils-BtbQaBiM.js","assets/FeatureReductionSelection-BgSaOl63.js","assets/fieldProperties-DwX3a7Tw.js","assets/I3SLayerDefinitions-BD1wrgQM.js","assets/labelingInfo-CDqcuavl.js","assets/labelUtils-CrPVFGbX.js","assets/LayerFloorInfo-BiEEzrkH.js","assets/fetchService-DX7NN7au.js","assets/persistable-Cd2AQV9l.js","assets/MD5-C9MwAd2G.js","assets/resourceExtension-BJZCYhPR.js","assets/styleUtils-B6is7UMm.js","assets/elevationInfoUtils-Dyub07Hc.js","assets/popupUtils-DKk4nxaP.js","assets/I3SUtil-Cnsi7l1D.js","assets/projectVectorToVector-CI2wpJv-.js","assets/sphere-C1Okwrd4.js","assets/I3SBinaryReader-C5dyRj0R.js","assets/VertexAttribute-BdZWZuT1.js","assets/floatRGBA-DqWlScAM.js","assets/NormalAttribute.glsl-D-WvD5ts.js","assets/interfaces-DDtDqZYj.js","assets/BindType-BmZEZMMh.js","assets/orientedBoundingBox-xa8VSmvW.js","assets/ViewingMode-dBUh39ak.js","assets/popupUtils-TUQSkM3Y.js","assets/gltfexport-CFCyN1Es.js","assets/editingSupport-COej-R5q.js"])))=>i.map(i=>d[i]);
import{j as o,m as c,gy as fr,u as mr,o as k,k as R,P as Q,eJ as Je,de as Pe,O as Ft,aY as _t,bb as Xe,s as _,b5 as ve,I as b,fJ as yr,c$ as E,b2 as gr,a8 as vr,lN as wr,lO as xr,lP as Be,j1 as me,bD as br,aN as F,bP as Ce,lQ as $r,im as Ye,lR as Ue,bT as Rt,aX as Sr,bU as Tr,hQ as Ot,_ as pe,w as Re,bw as M,fx as Ir,lS as Ar,k1 as Lr,hb as Fr,ay as _r,hT as Rr,ae as Oe,aq as jt,lT as Et,ft as Or,hj as je,fT as Dt,lU as Mt,fU as Pt,lV as Ct,c_ as jr,g8 as Er,hX as Dr,f6 as Mr,ao as Pr,c2 as Cr,lW as Ur,c0 as we,li as Nr,p as et,n as tt,ew as zr,Y as rt,hD as Wr,al as qr,eT as Vr,U as Ut,bi as Gr,ez as kr,v as Hr,Z as Br,gz as st,z as Qr,fk as Kr,l4 as Zr,d7 as Jr,X as it,gD as nt,ba as De,x as Xr,dL as Yr,k3 as es,gB as ts,$ as rs,eF as ss}from"./index-D2fbPmv2.js";import{S as is}from"./MultiOriginJSONSupport-CiWwiGwF.js";import{j as Nt,N as de,z as zt,w as $e,k as Wt,d as ns}from"./MeshTransform-B6vBmBoS.js";import{c as os}from"./imageUtils-ywQwDfd6.js";import{r as as,n as ls,p as Se}from"./MeshVertexAttributes-DUfgEic7.js";import{a as Ne,b as Te}from"./MeshLocalVertexSpace-DwlLUecc.js";import{a as fe,s as Ie,g as qt,u as cs}from"./meshVertexSpaceUtils-CCZ2kj4M.js";import{e as us}from"./earcut-Lltz9D9k.js";import{t as Vt}from"./Indices-CsOOuhq-.js";import{o as Ae,c as ps,u as ds,N as ze,A as hs,z as Gt,E as fs,g as ms}from"./vec32-wKfHB3TO.js";import{M as ys,O as gs,v as vs}from"./plane-BL9TfL1Z.js";import{e as ot}from"./deduplicate-p8eokHVd.js";import{c as z}from"./projectPointToVector-AEutsyFW.js";import{F as I,B as We,O as G,n as ws,k as kt,g as Ht,E as Bt,w as Qt,h as Kt,R as Zt,G as Jt}from"./vertexSpaceConversion-Cv5gEIZM.js";import{e as Ee}from"./mat4f64-CSKppSlJ.js";import{a as Qe}from"./spatialReferenceEllipsoidUtils-MKxqvfid.js";import{C as Xt}from"./computeTranslationToOriginAndRotation-Bz1fa-AB.js";import{e as at,i as xs}from"./vec3-DECf-4Ts.js";import{o as lt,h as bs,m as $s}from"./External-DYcXdrPy.js";import{e as Yt}from"./mat3f64-q3fE-ZOt.js";import{n as Ss}from"./mat3-CrHuGM2_.js";import{b as Ts}from"./quat-DicJuC4T.js";import{e as Is,r as As}from"./quatf64-aQ5IuZRd.js";import{i as Ls,m as Fs,t as _s}from"./meshSpatialReferenceScaleUtils-DD90M-OP.js";import{i as Rs}from"./APIKeyMixin-CajJ21HV.js";import{l as Os}from"./ArcGISService-CaAm5zrR.js";import{e as js}from"./CustomParametersMixin-BL7lOS1M.js";import{F as Es}from"./EditBusLayer-FZrvniEK.js";import{b as Ds}from"./OperationalLayer-OfS7ofUf.js";import{j as Ms}from"./PortalLayer-CvjKt5oM.js";import{R as Ps,V as ct}from"./SceneService-yhJDbsjz.js";import{f as Cs}from"./TemporalLayer-DsJdvu2C.js";import{d as ut,l as Us}from"./TimeInfo-L4LVijOt.js";import{s as Ns}from"./associatedFeatureServiceUtils-CXn7FUO4.js";import{t as zs}from"./capabilities-Y9lFlGVh.js";import{c as Ws,p as qs,d as Vs,l as Gs,s as ks}from"./commonProperties-ChaS5GS0.js";import{Z as Hs,K as Bs}from"./featureLayerUtils-BtbQaBiM.js";import{t as Qs,p as Ks}from"./FeatureReductionSelection-BgSaOl63.js";import{s as Zs}from"./fieldProperties-DwX3a7Tw.js";import{p as er,a as Js,y as Xs,m as Ys}from"./I3SLayerDefinitions-BD1wrgQM.js";import{r as ei,n as ti}from"./infoFor3D-CxdEiWhp.js";import{C as ri,n as pt}from"./labelingInfo-CDqcuavl.js";import{p as si}from"./LayerFloorInfo-BiEEzrkH.js";import{b as ii}from"./fetchService-DX7NN7au.js";import{j as ni}from"./persistable-Cd2AQV9l.js";import{t as oi}from"./styleUtils-B6is7UMm.js";import{$ as dt,P as ai,w as li}from"./elevationInfoUtils-Dyub07Hc.js";import{p as ci}from"./popupUtils-DKk4nxaP.js";import{V as ui}from"./I3SUtil-Cnsi7l1D.js";import{n as pi,p as di}from"./popupUtils-TUQSkM3Y.js";var X;const Me=new WeakMap;let hi=0,C=X=class extends Q{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,s){if(e instanceof HTMLImageElement){const i={type:"image-element",src:Je(e.src,s),crossOrigin:e.crossOrigin};t[r]=i}else if(e instanceof HTMLCanvasElement){const i={type:"canvas-element",imageData:ht(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[r]=i}else if(e instanceof HTMLVideoElement){const i={type:"video-element",src:Je(e.src,s),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=i}else if(e instanceof ImageData){const i={type:"image-data",imageData:ht(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=ft(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return ft(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const{data:e,url:t}=this;return e instanceof HTMLCanvasElement?mt(e.getContext("2d").getImageData(0,0,e.width,e.height)):e instanceof ImageData?mt(e):!(!(t!=null&&t.toLowerCase().endsWith(".png"))&&!(t!=null&&t.toLocaleLowerCase().startsWith("data:image/png;")))}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(Me.has(this.data)||Me.set(this.data,++hi),t(Me.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new X(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(e){return typeof e=="string"?new X({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new X({data:e}):Pe(X,e)}};function ht(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function ft(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return os(r,e.width,e.height)}function mt(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}o([c({type:String,json:{write:fr}})],C.prototype,"url",null),o([c({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),c()],C.prototype,"data",null),o([mr("data")],C.prototype,"writeData",null),o([k("data")],C.prototype,"readData",null),o([c({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],C.prototype,"transparent",null),o([c({json:{write:!0}})],C.prototype,"wrap",void 0),o([c({readOnly:!0})],C.prototype,"contentHash",null),C=X=o([R("esri.geometry.support.MeshTexture")],C);const ce=C;let Y=class extends Ft(Q){constructor(t){super(t),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};o([c({type:[Number],nonNullable:!0,json:{write:!0}})],Y.prototype,"offset",void 0),o([c({type:Number,nonNullable:!0,json:{write:!0}})],Y.prototype,"rotation",void 0),o([c({type:[Number],nonNullable:!0,json:{write:!0}})],Y.prototype,"scale",void 0),Y=o([R("esri.geometry.support.MeshTextureTransform")],Y);const ue=Y;var qe;let D=qe=class extends Q{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new qe(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,s),s}clonePropertiesWithDeduplication(e){var t,r,s,i;return{color:this.color!=null?this.color.clone():null,colorTexture:(t=this.colorTexture)==null?void 0:t.cloneWithDeduplication(e),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(s=this.colorTextureTransform)==null?void 0:s.clone(),normalTextureTransform:(i=this.normalTextureTransform)==null?void 0:i.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};o([c({type:_t,json:{write:!0}})],D.prototype,"color",void 0),o([c({type:ce,json:{write:!0}})],D.prototype,"colorTexture",void 0),o([c({type:ue,json:{write:!0}})],D.prototype,"colorTextureTransform",void 0),o([c({type:ce,json:{write:!0}})],D.prototype,"normalTexture",void 0),o([c({type:ue,json:{write:!0}})],D.prototype,"normalTextureTransform",void 0),o([c({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaMode",void 0),o([c({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaCutoff",void 0),o([c({nonNullable:!0,json:{write:!0}})],D.prototype,"doubleSided",void 0),D=qe=o([R("esri.geometry.support.MeshMaterial")],D);const Ke=D;var Ve;let O=Ve=class extends Ke{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new Ve(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,s),s}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}clonePropertiesWithDeduplication(e){var t,r,s,i,n,a,l;return{...super.clonePropertiesWithDeduplication(e),emissiveColor:(t=this.emissiveColor)==null?void 0:t.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(e),emissiveTextureTransform:(s=this.emissiveTextureTransform)==null?void 0:s.clone(),occlusionTexture:(i=this.occlusionTexture)==null?void 0:i.cloneWithDeduplication(e),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(a=this.metallicRoughnessTexture)==null?void 0:a.cloneWithDeduplication(e),metallicRoughnessTextureTransform:(l=this.metallicRoughnessTextureTransform)==null?void 0:l.clone()}}};o([c({type:_t,json:{write:!0}})],O.prototype,"emissiveColor",void 0),o([c({type:ce,json:{write:!0}})],O.prototype,"emissiveTexture",void 0),o([c({type:ue,json:{write:!0}})],O.prototype,"emissiveTextureTransform",void 0),o([c({type:ce,json:{write:!0}})],O.prototype,"occlusionTexture",void 0),o([c({type:ue,json:{write:!0}})],O.prototype,"occlusionTextureTransform",void 0),o([c({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],O.prototype,"metallic",void 0),o([c({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],O.prototype,"roughness",void 0),o([c({type:ce,json:{write:!0}})],O.prototype,"metallicRoughnessTexture",void 0),o([c({type:ue,json:{write:!0}})],O.prototype,"metallicRoughnessTextureTransform",void 0),O=Ve=o([R("esri.geometry.support.MeshMaterialMetallicRoughness")],O);const fi=O;var oe;let U=oe=class extends Q{static from(e){return Pe(oe,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return ls(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},_.getLogger(this))}castMaterial(e){return Pe(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?fi:Ke,e)}clone(){return new oe({faces:ve(this.faces),shading:this.shading,material:ve(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(e,t){const r={faces:ve(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new oe(r)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};o([c({json:{write:as}})],U.prototype,"faces",void 0),o([Xe("faces")],U.prototype,"castFaces",null),o([c({type:Ke,json:{write:!0}})],U.prototype,"material",void 0),o([Xe("material")],U.prototype,"castMaterial",null),o([c({json:{write:!0}})],U.prototype,"name",void 0),o([c({type:String,json:{write:!0}})],U.prototype,"shading",void 0),o([c({type:Boolean})],U.prototype,"trustSourceNormals",void 0),U=oe=o([R("esri.geometry.support.MeshComponent")],U);const ie=U,mi="Mesh must be loaded before applying operations",yi="Provided component is not part of the list of components",gi="Expected polygon to be a Polygon instance",ae="Expected location to be a Point instance";let yt=class extends b{constructor(){super("invalid-input:location",ae)}};function vi(e,t,r){const s=wi(gt,e,t,r)?gs(gt):[0,0,1];return Math.abs(s[2])>Math.cos(yr(80))?E.Z:Math.abs(s[1])>Math.abs(s[0])?E.Y:E.X}function wi(e,t,r,s){const i=(a=>!Array.isArray(a[0]))(t)?(a,l)=>t[3*a+l]:(a,l)=>t[a][l],n=s?gr(s)/vr(s):1;return vs(e,(a,l)=>Ae(a,i(l,0)*n,i(l,1)*n,i(l,2)),r)}const gt=ys();function xi(e){const t=$i(e.rings,e.hasZ,Le.CCW_IS_HOLE,e.spatialReference),r=new Array;let s=0,i=0;for(const l of t.polygons){const u=l.count,p=l.index,d=wr(t.position,3*p,3*u),m=l.holeIndices.map(f=>f-p),y=Vt(us(d,m,3));r.push({position:d,faces:y}),s+=d.length,i+=y.length}const n=bi(r,s,i),a=Array.isArray(n.position)?ot(n.position,3,{originalIndices:n.faces}):ot(n.position.buffer,6,{originalIndices:n.faces});return n.position=xr(new Float64Array(a.buffer)),n.faces=a.indices,n}function bi(e,t,r){if(e.length===1)return e[0];const s=Be(t),i=new Array(r);let n=0,a=0,l=0;for(const u of e){for(let p=0;p<u.position.length;p++)s[n++]=u.position[p];for(const p of u.faces)i[a++]=p+l;l=n/3}return{position:s,faces:Vt(i)}}function $i(e,t,r,s){const i=e.length,n=new Array(i),a=new Array(i),l=new Array(i);let u=0;for(let g=0;g<i;++g)u+=e[g].length;let p=0,d=0,m=0;const y=Be(3*u);let f=0;for(let g=i-1;g>=0;g--){const v=e[g],$=r===Le.CCW_IS_HOLE&&Si(v,t,s);if($&&i!==1)n[p++]=v;else{let A=v.length;for(let w=0;w<p;++w)A+=n[w].length;const x={index:f,pathLengths:new Array(p+1),count:A,holeIndices:new Array(p)};x.pathLengths[0]=v.length,v.length>0&&(l[m++]={index:f,count:v.length}),f=$?ye(v,v.length-1,-1,y,f,v.length,t):ye(v,0,1,y,f,v.length,t);for(let w=0;w<p;++w){const T=n[w];x.holeIndices[w]=f,x.pathLengths[w+1]=T.length,T.length>0&&(l[m++]={index:f,count:T.length}),f=ye(T,0,1,y,f,T.length,t)}p=0,x.count>0&&(a[d++]=x)}}for(let g=0;g<p;++g){const v=n[g];v.length>0&&(l[m++]={index:f,count:v.length}),f=ye(v,0,1,y,f,v.length,t)}return a.length=d,l.length=m,{position:y,polygons:a,outlines:l}}function ye(e,t,r,s,i,n,a){i*=3;for(let l=0;l<n;++l){const u=e[t];s[i++]=u[0],s[i++]=u[1],s[i++]=a&&u[2]?u[2]:0,t+=r}return i/3}function Si(e,t,r){if(!t)return!me(e);const s=e.length-1;switch(vi(e,s,r)){case E.X:return!me(e,E.Y,E.Z);case E.Y:return!me(e,E.X,E.Z);case E.Z:return!me(e,E.X,E.Y)}}var Le;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Le||(Le={}));function Ze(e,t,r,s){if(s!==void 0){br(e(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});const i=t.type==="local";if(!fe(t)||s===i)return r.isGeographic||r.isWebMercator&&s;e().warnOnce(`Specifying the 'geographic' parameter (${s}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}switch(t.type){case"georeferenced":return r.isGeographic;case"local":return r.isGeographic||r.isWebMercator}}const he=()=>_.getLogger("esri.geometry.support.meshUtils.centerAt");function Ti(e,t,r){var a;if(!((a=e.vertexAttributes)!=null&&a.position))return;const{vertexSpace:s}=e,i=(r==null?void 0:r.origin)??e.origin,n=Ze(he,s,i.spatialReference,r==null?void 0:r.geographic);fe(s)?Ii(e,t,i):n?Ai(e,t,i):Li(e,t,i)}function Ii(e,t,r){const{vertexSpace:s}=e;if(!fe(s))return;const i=rr,n=tr;if(!z(t,n,e.spatialReference))return void I(he(),t.spatialReference,e.spatialReference,G);if(!z(r,i,e.spatialReference)){const l=e.origin;return i[0]=l.x,i[1]=l.y,i[2]=l.z,void I(he(),r.spatialReference,e.spatialReference,G)}const a=ps(_i,n,i);s.origin=ds(F(),s.origin,a)}function Ai(e,t,r){const s=Ce(r.x,r.y,r.z??0),i=We(e,new Ne({origin:s}));if(!i)return;const n=Ce(t.x,t.y,t.z??0),a=We({vertexAttributes:i,spatialReference:e.spatialReference,vertexSpace:new Ne({origin:n})},Te.absolute);if(!a)return;const{position:l,normal:u,tangent:p}=a;e.vertexAttributes.position=l,e.vertexAttributes.normal=u,e.vertexAttributes.tangent=p,e.vertexAttributesChanged()}function Li(e,t,r){const s=rr,i=tr;if(z(t,i,e.spatialReference)){if(!z(r,s,e.spatialReference)){const n=e.origin;return s[0]=n.x,s[1]=n.y,s[2]=n.z,void I(he(),r.spatialReference,e.spatialReference,G)}Fi(e.vertexAttributes.position,i,s),e.vertexAttributesChanged()}else I(he(),t.spatialReference,e.spatialReference,G)}function Fi(e,t,r){if(e)for(let s=0;s<e.length;s+=3)for(let i=0;i<3;i++)e[s+i]+=t[i]-r[i]}const tr=F(),rr=F(),_i=F();function Ri(e){const{spatialReference:t,vertexSpace:r,untransformedBounds:s}=e,i=$r(s,Oi);if(fe(r)&&e.transform&&at(i,i,e.transform.localMatrix),r.type==="georeferenced"){const l=r.origin;return l&&xs(i,i,l),Ye(Ue(i),t)}const n=Qe(t),a=r.origin;if(!Rt(n,t)){const[l,u,p]=a;return new Sr({xmin:l,ymin:u,zmin:p,xmax:l,ymax:u,zmax:p,spatialReference:t})}return Xt(t,a,vt,n),at(i,i,vt),Tr(i,n,0,i,t,0),Ye(Ue(i),t)}const vt=Ee(),Oi=Be(24);async function ji(e,t,r){const{source:s}=t,{loadGLTFMesh:i}=await Ot(pe(()=>import("./loadGLTFMesh-Cw-6WX7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),r),n=await Di(s,r);Re(r);const a=i(new M({x:0,y:0,z:0,spatialReference:e.spatialReference}),n.url,{resolveFile:Ei(n),signal:r==null?void 0:r.signal,expectedType:n.type,unitConversionDisabled:t.unitConversionDisabled});a.then(()=>n.dispose(),()=>n.dispose());const{vertexAttributes:l,components:u}=await a;e.vertexAttributes=l,e.components=u}function Ei(e){const t=Ir(e.url);return r=>{const s=Ar(r,t,t),i=s?s.replace(/^ *\.\//,""):null;return(i?e.files.get(i):null)??r}}async function Di(e,t){if(Array.isArray(e)){if(!e.length)throw new b("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?Pi(e):Ci(e,t)}return sr(e)}async function Mi(e,t){const{parts:r,assetMimeType:s,assetName:i}=e;if(r.length===1)return new Fe(r[0].partUrl);const n=await e.toBlob(t);return Re(t),Fe.fromBlob(n,lr(i,s))}function sr(e){return Fe.fromBlob(e,lr(e.name,e.type))}function Pi(e){return or(e.map(t=>({name:t.name,mimeType:t.type,source:sr(t)})))}async function Ci(e,t){const r=await Lr(e.map(async s=>{const i=await Mi(s);return Re(t),{name:s.assetName,mimeType:s.assetMimeType,source:i}}));if(Fr(t))throw r.forEach(s=>s.source.dispose()),_r();return or(r)}const ir=/^model\/gltf\+json$/,nr=/^model\/gltf-binary$/,Ge=/\.gltf$/i,Ui=/\.glb$/i;function wt({mimeType:e,source:t,name:r}){return ir.test(e)||Ge.test(r)?{url:t.url,type:"gltf"}:nr.test(e)||Ui.test(r)?{url:t.url,type:"glb"}:null}function or(e){const t=new Map;let r=null,s=null;for(const n of e){const{source:a,name:l}=n;r??(r=wt(n)),l==="ESRI3DO_NORM.glb"&&(s=wt(n)),t.set(l,a.url),a.files.forEach((u,p)=>t.set(p,u))}const i=s??r;if(i==null)throw new b("mesh-load-external:missing-files","Missing files to load external mesh source");return new Fe(i.url,()=>e.forEach(({source:n})=>n.dispose()),t,i.type)}let Fe=class ar{constructor(t,r=()=>{},s=new Map,i){this.url=t,this.dispose=r,this.files=s,this.type=i}static fromBlob(t,r){const s=URL.createObjectURL(t);return new ar(s,()=>URL.revokeObjectURL(s),void 0,r)}};function lr(e,t){return ir.test(t)||Ge.test(e)?"gltf":nr.test(t)||Ge.test(e)?"glb":void 0}let N=class extends Rr{constructor(t){super(t),this.externalSources=new Oe,this._explicitDisplaySource=null,this.georeferenced=!1,this.addHandles(jt(()=>this.externalSources,"after-remove",({item:r})=>{r===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(t){if(t!=null&&!lt(t))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=t,t&&this.externalSources.every(r=>!bs(r,t))&&this.externalSources.add(t)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(t){return this.externalSources.items.filter(r=>$s(r,t))}get _implicitDisplaySource(){return this.externalSources.find(lt)}};o([c()],N.prototype,"externalSources",void 0),o([c()],N.prototype,"displaySource",null),o([c()],N.prototype,"_implicitDisplaySource",null),o([c()],N.prototype,"_explicitDisplaySource",void 0),o([c()],N.prototype,"georeferenced",void 0),N=o([R("esri.geometry.support.meshUtils.Metadata")],N);function Ni(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:r}=Qi,s=4*e.length,i=new Float64Array(3*s),n=new Float32Array(3*s),a=new Float32Array(2*s),l=new Uint32Array(2*e.length*3);let u=0,p=0,d=0,m=0;for(let y=0;y<e.length;y++){const f=e[y],g=u/3;for(const $ of t)l[m++]=g+$;const v=f.corners;for(let $=0;$<4;$++){const A=v[$];let x=0;a[d++]=.25*r[$][0]+f.uvOrigin[0],a[d++]=f.uvOrigin[1]-.25*r[$][1];for(let w=0;w<3;w++)f.axis[w]!==0?(i[u++]=.5*f.axis[w],n[p++]=f.axis[w]):(i[u++]=.5*A[x++],n[p++]=0)}}return{position:i,normal:n,uv:a,faces:l}}function zi(e,t){const r=e.components[0],s=r.faces,i=Ki[t],n=6*i,a=new Array(6),l=new Array(s.length-6);let u=0,p=0;for(let d=0;d<s.length;d++)d>=n&&d<n+6?a[u++]=s[d]:l[p++]=s[d];if(e.vertexAttributes.uv!=null){const d=new Float32Array(e.vertexAttributes.uv),m=4*i*2,y=[0,1,1,1,1,0,0,0];for(let f=0;f<y.length;f++)d[m+f]=y[f];e.vertexAttributes.uv=d}return e.components=[new ie({faces:a,material:r.material}),new ie({faces:l})],e}function Wi(e=0){const t=Math.round(8*2**e),r=2*t,s=(t-1)*(r+1)+2*r,i=new Float64Array(3*s),n=new Float32Array(3*s),a=new Float32Array(2*s),l=new Uint32Array(3*((t-1)*r*2));let u=0,p=0,d=0,m=0;for(let y=0;y<=t;y++){const f=y/t*Math.PI+.5*Math.PI,g=Math.cos(f),v=Math.sin(f);S[2]=v;const $=y===0||y===t,A=$?r-1:r;for(let x=0;x<=A;x++){const w=x/A*2*Math.PI;S[0]=-Math.sin(w)*g,S[1]=Math.cos(w)*g;for(let T=0;T<3;T++)i[u]=.5*S[T],n[u]=S[T],++u;a[p++]=(x+($?.5:0))/r,a[p++]=y/t,y!==0&&x!==r&&(y!==t&&(l[d++]=m,l[d++]=m+1,l[d++]=m-r),y!==1&&(l[d++]=m,l[d++]=m-r,l[d++]=m-r-1)),m++}}return{position:i,normal:n,uv:a,faces:l}}function qi(e=0){const r=Math.round(16*2**e),s=4*(r+1)+2*r,i=new Float64Array(3*s),n=new Float32Array(3*s),a=new Float32Array(2*s),l=new Uint32Array(3*(4*r));let u=0,p=0,d=0,m=0,y=0;for(let f=0;f<=5;f++){const g=f===0||f===5,v=f<=1||f>=4,$=f===2||f===4,A=g?r-1:r;for(let x=0;x<=A;x++){const w=x/A*2*Math.PI,T=g?0:.5;S[0]=T*Math.sin(w),S[1]=T*-Math.cos(w),S[2]=f<=2?.5:-.5;for(let W=0;W<3;W++)i[u++]=S[W],n[p++]=v?W===2?f<=1?1:-1:0:W===2?0:S[W]/T;a[d++]=(x+(g?.5:0))/r,a[d++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,$||f===0||x===r||(f!==5&&(l[m++]=y,l[m++]=y+1,l[m++]=y-r),f!==1&&(l[m++]=y,l[m++]=y-r,l[m++]=y-r-1)),y++}}return{position:i,normal:n,uv:a,faces:l}}function Vi(e,t){const r=typeof t=="number"?t:t!=null?t.width:1,s=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:r,depth:s};case"north":case"south":return{width:r,height:s};case"east":case"west":return{depth:r,height:s}}}function Gi(e){const t=ne.facingAxisOrderSwap[e],r=ne.position,s=ne.normal,i=new Float64Array(r.length),n=new Float32Array(s.length);let a=0;for(let l=0;l<4;l++){const u=a;for(let p=0;p<3;p++){const d=t[p],m=Math.abs(d)-1,y=d>=0?1:-1;i[a]=r[u+m]*y,n[a]=s[u+m]*y,a++}}return{position:i,normal:n,uv:new Float32Array(ne.uv),faces:new Uint32Array(ne.faces),isPlane:!0}}const K=1,Z=2,J=3,ne={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[J,K,Z],west:[-J,-K,Z],north:[-K,J,Z],south:[K,-J,Z],up:[K,Z,J],down:[K,-Z,-J]}};function ge(e,t,r){e.isPlane||ki(e),Bi(e,Hi(r==null?void 0:r.size,r==null?void 0:r.unit,t.spatialReference));const s=Ie(t,r),i=t.spatialReference.isGeographic?Ie(t):s,n=We({vertexAttributes:e,vertexSpace:i,spatialReference:t.spatialReference},s,{allowBufferReuse:!0});return{vertexAttributes:new Se({...n,uv:e.uv}),vertexSpace:s,components:[new ie({faces:e.faces,material:(r==null?void 0:r.material)||null})],spatialReference:t.spatialReference}}function ki(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Hi(e,t,r){const s=ws(t,r);if(e==null&&s===1)return null;if(e==null)return[s,s,s];if(typeof e=="number"){const i=e*s;return[i,i,i]}return[e.width!=null?e.width*s:s,e.depth!=null?e.depth*s:s,e.height!=null?e.height*s:s]}function Bi(e,t){if(t!=null){q[0]=t[0],q[4]=t[1],q[8]=t[2];for(let r=0;r<e.position.length;r+=3){for(let s=0;s<3;s++)S[s]=e.position[r+s];ze(S,S,q);for(let s=0;s<3;s++)e.position[r+s]=S[s]}if(t[0]!==t[1]||t[1]!==t[2]){q[0]=1/t[0],q[4]=1/t[1],q[8]=1/t[2];for(let r=0;r<e.normal.length;r+=3){for(let s=0;s<3;s++)S[s]=e.normal[r+s];ze(S,S,q),hs(S,S);for(let s=0;s<3;s++)e.normal[r+s]=S[s]}}}}const Qi={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Ki={south:0,east:1,north:2,west:3,up:4,down:5},S=F(),q=Yt(),H=()=>_.getLogger("esri.geometry.support.meshUtils.rotate");function Zi(e,t,r){var u;if(!((u=e.vertexAttributes)!=null&&u.position)||t[3]===0)return;const{spatialReference:s,vertexSpace:i}=e,n=(r==null?void 0:r.origin)??e.origin,a=r==null?void 0:r.geographic,l=Ze(H,i,s,a);qt(e)?Ji(e,t,n):l?Xi(e,t,n):Yi(e,t,n)}function Ji(e,t,r){e.transform??(e.transform=new de);const{vertexSpace:s,transform:i,spatialReference:n}=e,[a,l,u]=s.origin,p=new M({x:a,y:l,z:u,spatialReference:n}),d=te;if(p.equals(r))Ae(d,0,0,0);else if(!kt(d,r,e))return void I(H(),r.spatialReference,n,G);Ts(St,$e(t),zt(t));const m=Et(xt,St,je,Or,d),{localMatrix:y}=i,f=Dt(xt,m,y);i.scale=Mt(F(),f),Pt(f,f,Gt(te,i.scale));const g=i.rotationAxis;i.rotation=Wt(f),i.rotationAngle===0&&(i.rotationAxis=g),i.translation=Ct(F(),f)}function Xi(e,t,r){const s=e.spatialReference,i=Qe(s),n=cr;if(!z(r,n,i)&&(I(H(),r.spatialReference,i,"Falling back to mesh origin"),!z(e.origin,n,i)))return void I(H(),e.origin.spatialReference,i);const a=e.vertexAttributes.position,l=e.vertexAttributes.normal,u=e.vertexAttributes.tangent,p=new Float64Array(a.length),d=l!=null?new Float32Array(l.length):null,m=u!=null?new Float32Array(u.length):null;Xt(i,n,_e,i),Ss($t,_e);const y=bt;ze($e(bt),$e(t),$t),y[3]=t[3],Ht(a,s,p,i)&&(l==null||d==null||Bt(l,a,s,p,i,d))&&(u==null||m==null||Qt(u,a,s,p,i,m))?(se(p,y,3,n),Kt(p,i,a,s)&&(l==null||d==null||(se(d,y,3),Zt(d,a,s,p,i,l)))&&(u==null||m==null||(se(m,y,4),Jt(m,a,s,p,i,u)))?e.vertexAttributesChanged():I(H(),i,s)):I(H(),s,i)}function Yi(e,t,r){const s=cr;if(!z(r,s,e.spatialReference)){const i=e.origin;return s[0]=i.x,s[1]=i.y,s[2]=i.z,void I(H(),r.spatialReference,e.spatialReference,G)}se(e.vertexAttributes.position,t,3,s),se(e.vertexAttributes.normal,t,3),se(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function se(e,t,r,s=je){if(e!=null){jr(_e,zt(t),$e(t));for(let i=0;i<e.length;i+=r){for(let n=0;n<3;n++)te[n]=e[i+n]-s[n];fs(te,te,_e);for(let n=0;n<3;n++)e[i+n]=te[n]+s[n]}}}const te=F(),xt=Ee(),bt=Nt(),_e=Ee(),$t=Yt(),cr=F(),St=Is(),B=()=>_.getLogger("esri.geometry.support.meshUtils.scale");function en(e,t,r){var u;if(!((u=e.vertexAttributes)!=null&&u.position))return;const{vertexSpace:s,spatialReference:i}=e,n=(r==null?void 0:r.origin)??e.origin,a=r==null?void 0:r.geographic,l=Ze(B,s,i,a);qt(e)?tn(e,t,n):l?rn(e,t,n):sn(e,t,n)}function tn(e,t,r){e.transform??(e.transform=new de);const{vertexSpace:s,transform:i,spatialReference:n}=e,[a,l,u]=s.origin,p=new M({x:a,y:l,z:u,spatialReference:n}),d=re;if(p.equals(r))Ae(d,0,0,0);else if(!kt(d,r,e))return void I(B(),r.spatialReference,n,G);const m=Ae(nn,t,t,t),y=Et(Tt,As,je,m,d),{localMatrix:f}=i,g=Dt(Tt,y,f);i.scale=Mt(F(),g),Pt(g,g,Gt(re,i.scale));const v=i.rotationAxis;i.rotation=Wt(g),i.rotationAngle===0&&(i.rotationAxis=v),i.translation=Ct(F(),g)}function rn(e,t,r){const s=e.spatialReference,i=Qe(s),n=pr;if(!z(r,n,i)&&(I(B(),r.spatialReference,i,"Falling back to mesh origin"),!z(e.origin,n,i)))return void I(B(),e.origin.spatialReference,i);const a=e.vertexAttributes.position,l=e.vertexAttributes.normal,u=e.vertexAttributes.tangent,p=new Float64Array(a.length),d=l!=null?new Float32Array(l.length):null,m=u!=null?new Float32Array(u.length):null;Ht(a,s,p,i)&&(l==null||d==null||Bt(l,a,s,p,i,d))&&(u==null||m==null||Qt(u,a,s,p,i,m))?(ur(p,t,n),Kt(p,i,a,s)&&(l==null||d==null||Zt(d,a,s,p,i,l))&&(u==null||m==null||Jt(m,a,s,p,i,u))?e.vertexAttributesChanged():I(B(),i,s)):I(B(),s,i)}function sn(e,t,r){const s=pr;if(!z(r,s,e.spatialReference)){const i=e.origin;return s[0]=i.x,s[1]=i.y,s[2]=i.z,void I(B(),r.spatialReference,e.spatialReference,G)}ur(e.vertexAttributes.position,t,s),e.vertexAttributesChanged()}function ur(e,t,r=je){if(e)for(let s=0;s<e.length;s+=3){for(let i=0;i<3;i++)re[i]=e[s+i]-r[i];ms(re,re,t);for(let i=0;i<3;i++)e[s+i]=re[i]+r[i]}}const re=F(),nn=F(),Tt=Ee(),pr=F();var j;const dr="esri.geometry.Mesh";function P(){return _.getLogger(dr)}const on={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:Te,local:Ne}};let L=j=class extends Er.LoadableMixin(Dr(Mr)){constructor(e){super(e),this.components=null,this.vertexSpace=new Te,this.transform=null,this.metadata=new N,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new Se,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(Pr(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(t=>t.clone())}},()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){var e;return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):((e=this.metadata.displaySource)==null?void 0:e.extent)!=null}get _transformedExtent(){const{spatialReference:e,vertexSpace:t}=this,r=this;return Ri({get transform(){return r.transform},vertexSpace:t,spatialReference:e,untransformedBounds:this._untransformedBounds})}get _untransformedBounds(){const{vertexAttributes:{position:e},components:t}=this;return e.length===0||(t==null?void 0:t.length)===0?Cr(Ur):Ue(e)}get origin(){const e=cs(this.vertexSpace,this.spatialReference);if(e!=null)return e;const{center:t,zmin:r}=this._transformedExtent;return new M({x:t.x,y:t.y,z:r,spatialReference:this.spatialReference})}get extent(){var e,t;return this.loaded||((t=(e=this.metadata)==null?void 0:e.displaySource)==null?void 0:t.extent)==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(ie.from(e)),this.notifyChange("components"))}removeComponent(e){if(this._checkIfLoaded("removeComponent()")){if(this.components){const t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}P().error("removeComponent()",yi)}}rotate(e,t,r,s){return ns(e,t,r,It),Zi(this,It,s),this}offset(e,t,r){if(!this._checkIfLoaded("offset()"))return this;const{vertexSpace:s,vertexAttributes:i}=this,n=i==null?void 0:i.position;if(!n)return this;if(fe(s)){const[a,l,u]=s.origin;s.origin=Ce(a+e,l+t,u+r)}else{for(let a=0;a<n.length;a+=3)n[a]+=e,n[a+1]+=t,n[a+2]+=r;this.vertexAttributesChanged()}return this}scale(e,t){return this._checkIfLoaded("scale()")?(en(this,e,t),this):this}centerAt(e,t){return this._checkIfLoaded("centerAt()")?(Ti(this,e,t),this):this}load(e){const{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise(ji(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone(),{preserveMetadata:!0})}cloneAndModifyVertexAttributes(e,t,r){var n;let s=null;if(this.components){const a=new Map,l=new Map;s=this.components.map(u=>u.cloneWithDeduplication(a,l))}const i={components:s,spatialReference:this.spatialReference,vertexAttributes:e,vertexSpace:t,transform:((n=this.transform)==null?void 0:n.clone())??null,metadata:r!=null&&r.preserveMetadata?this.metadata.clone():new N};return new j(i)}cloneShallow(){return new j({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const[{toBinaryGLTF:t}]=await Promise.all([pe(()=>import("./gltfexport-CFCyN1Es.js"),__vite__mapDeps([82,1,2,16,4,17,7,22,3,14,23,24,25,6,8,10,9,11,15,18,19,26,27,28,5,29,21,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),this.load(e)]);return Re(e),await t(this,e)}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(const t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(e){return!!this.loaded||(P().error(e,mi),!1)}static createBox(e,t){if(!(e instanceof M))return P().error(".createBox()",ae),null;const r=new j(ge(Ni(),e,t));return t!=null&&t.imageFace&&t.imageFace!=="all"?zi(r,t.imageFace):r}static createSphere(e,t){return e instanceof M?new j(ge(Wi((t==null?void 0:t.densificationFactor)||0),e,t)):(P().error(".createSphere()",ae),null)}static createCylinder(e,t){return e instanceof M?new j(ge(qi((t==null?void 0:t.densificationFactor)||0),e,t)):(P().error(".createCylinder()",ae),null)}static createPlane(e,t){if(!(e instanceof M))return P().error(".createPlane()",ae),null;const r=(t==null?void 0:t.facing)??"up",s=Vi(r,t==null?void 0:t.size);return new j(ge(Gi(r),e,{...t,size:s}))}static createFromPolygon(e,t){if(!(e instanceof we))return P().error(".createFromPolygon()",gi),null;const r=xi(e);return new j({vertexAttributes:new Se({position:r.position}),components:[new ie({faces:r.faces,shading:"flat",material:(t==null?void 0:t.material)??null})],spatialReference:e.spatialReference,vertexSpace:new Te})}static async createFromGLTF(e,t,r){if(!(e instanceof M)){const i=new yt;throw P().error(".createfromGLTF()",i.message),i}const{loadGLTFMesh:s}=await Ot(pe(()=>import("./loadGLTFMesh-Cw-6WX7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),r);return new j(await s(e,t,r))}static async createFromFiles(e,t,r){Nr(P(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});const s=i=>P().error(".createFromFiles()",i.message);if(!(e instanceof M)){const i=new yt;throw s(i),i}if(!(r!=null&&r.layer))throw new b("invalid:no-layer","SceneLayer required for file to mesh conversion.");return r.layer.convertMesh(t,{location:e,...r})}static createWithExternalSource(e,t,r){var d;const s=(r==null?void 0:r.extent)??null,{spatialReference:i}=e,n=((d=r==null?void 0:r.transform)==null?void 0:d.clone())??new de,a=Ie(e,r),l=r==null?void 0:r.unitConversionDisabled,u={source:t,extent:s,unitConversionDisabled:l},p=new N;return p.externalSources.push(u),new j({metadata:p,transform:n,vertexSpace:a,spatialReference:i})}static createIncomplete(e,t){var a;const{spatialReference:r}=e,s=((a=t==null?void 0:t.transform)==null?void 0:a.clone())??new de,i=Ie(e,t),n=new j({transform:s,vertexSpace:i,spatialReference:r});return n.addResolvingPromise(Promise.reject(new b("mesh-incomplete","Mesh resources are not complete"))),n}};o([c({type:[ie],json:{write:!0}})],L.prototype,"components",void 0),o([c({nonNullable:!0,types:on,constructOnly:!0,json:{write:!0}})],L.prototype,"vertexSpace",void 0),o([c({type:de,json:{write:!0}})],L.prototype,"transform",void 0),o([c({constructOnly:!0})],L.prototype,"metadata",void 0),o([c()],L.prototype,"hasExtent",null),o([c()],L.prototype,"_transformedExtent",null),o([c()],L.prototype,"_untransformedBounds",null),o([c()],L.prototype,"origin",null),o([c({readOnly:!0,json:{read:!1}})],L.prototype,"extent",null),o([c({readOnly:!0,json:{read:!1,write:!0,default:!0}})],L.prototype,"hasZ",void 0),o([c({readOnly:!0,json:{read:!1,write:!0,default:!1}})],L.prototype,"hasM",void 0),o([c({type:Se,nonNullable:!0,json:{write:!0}})],L.prototype,"vertexAttributes",void 0),L=j=o([R(dr)],L);const It=Nt(),an=L;function hr({associatedLayer:e,serviceUpdateTimeStamp:t}){var l;const r=(l=e==null?void 0:e.editingInfo)==null?void 0:l.lastEditDate,s=e==null?void 0:e.serverGens,i=r!=null,n=t!=null,a=i&&n&&t.lastUpdate!==r.getTime();return i&&(a||!n&&(s==null?void 0:s.minServerGen)!==(s==null?void 0:s.serverGen))}const ln=e=>{let t=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){var i;const r=(i=this.associatedLayer)==null?void 0:i.timeInfo;if(r==null)return null;const s=r.clone();return tt(s,this.fieldsIndex),s}set timeInfo(r){tt(r,this.fieldsIndex),this._override("timeInfo",r)}get timeExtent(){var r;return(r=this.associatedLayer)==null?void 0:r.timeExtent}set timeExtent(r){this._override("timeExtent",r)}get timeOffset(){var r;return(r=this.associatedLayer)==null?void 0:r.timeOffset}set timeOffset(r){this._override("timeOffset",r)}get datesInUnknownTimezone(){var r;return((r=this.associatedLayer)==null?void 0:r.datesInUnknownTimezone)??!1}set datesInUnknownTimezone(r){this._override("datesInUnknownTimezone",r)}async loadTimeInfoFromService(r){const{serviceTimeInfo:s}=this;if(s==null)return;const{startTimeField:i,endTimeField:n}=s;if(i==null&&n==null||hr({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;const a=async d=>{var A;let m=null;try{const x=await((A=this.fetchStatistics)==null?void 0:A.call(this,d,r));m=x==null?void 0:x.stats}catch{}if(m==null)return null;const{minTimeStr:y,min:f,maxTimeStr:g,max:v}=m,$=d===i?y??f:g??v;return $!=null?new Date($):null},[l,u]=await Promise.all([a(i),a(n)]);if(i!=null&&l==null||n!=null&&u==null)return;const p=new et({start:l,end:u});this.setAtOrigin("timeInfo",new ut({endField:n,startField:i,fullTimeExtent:p}),"service")}};return o([c({type:ut,json:{read:!1,write:!1}})],t.prototype,"timeInfo",null),o([c({type:et,json:{read:!1,write:!1}})],t.prototype,"timeExtent",null),o([c({type:Us,json:{read:!1,write:!1}})],t.prototype,"timeOffset",null),o([c({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"datesInUnknownTimezone",null),o([c({type:le,readOnly:!0,json:{read:{source:"timeInfo"}}})],t.prototype,"serviceTimeInfo",void 0),t=o([R("esri.layers.mixins.TemporalSceneLayer")],t),t};let le=class extends Q{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};o([c({type:String})],le.prototype,"endTimeField",void 0),o([c({type:String})],le.prototype,"startTimeField",void 0),le=o([R("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],le);let V=class extends Q{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};o([c({type:String,json:{read:!0,write:!0}})],V.prototype,"name",void 0),o([c({type:String,json:{read:!0,write:!0}})],V.prototype,"field",void 0),o([c({type:[Number],json:{read:!0,write:!0}})],V.prototype,"currentRangeExtent",void 0),o([c({type:[Number],json:{read:!0,write:!0}})],V.prototype,"fullRangeExtent",void 0),o([c({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],V.prototype,"type",void 0),V=o([R("esri.layers.support.RangeInfo")],V);var xe;let ke=xe=class extends zr(Oe.ofType(we)){constructor(e){super(e)}clone(){return new xe(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var r,s;const t=(r=e==null?void 0:e.layer)==null?void 0:r.spatialReference;return t?this.toArray().map(i=>{var a;if(!t.equals(i.spatialReference)){if(!Rt(i.spatialReference,t))return(a=e==null?void 0:e.messages)==null||a.push(new rt("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const l=new we;Wr(i,l,t),i=l}const n=i.toJSON(e);return delete n.spatialReference,n}).filter(i=>i!=null):((s=e==null?void 0:e.messages)==null||s.push(new rt("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(i=>i.toJSON(e)))}static fromJSON(e,t){const r=new xe;return e.forEach(s=>r.add(we.fromJSON(s,t))),r}};ke=xe=o([R("esri.layers.support.PolygonCollection")],ke);const be=ke;var He;let ee=He=class extends Q{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new be,this._geometriesSource=null}initialize(){this.addHandles(jt(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,qr))}readGeometries(e,t,r){Array.isArray(e)?this.geometries=be.fromJSON(e,r):this._geometriesSource={url:Vr(e,r),context:r}}async loadGeometries(e,t){if(this._geometriesSource==null)return;const{url:r,context:s}=this._geometriesSource,i=await Ut(r,{responseType:"json",signal:t==null?void 0:t.signal}),n=e.toJSON(),a=i.data.map(l=>({...l,spatialReference:n}));this.geometries=be.fromJSON(a,s),this._geometriesSource=null}clone(){const e=new He({geometries:ve(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};o([c({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],ee.prototype,"spatialRelationship",void 0),o([c({type:be,nonNullable:!0,json:{write:!0}}),ni({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],ee.prototype,"geometries",void 0),o([k(["web-scene","portal-item"],"geometries")],ee.prototype,"readGeometries",null),ee=He=o([R("esri.layers.support.SceneFilter")],ee);const cn=ee;async function un({fieldName:e,statisticsInfo:t,errorContext:r,fieldsIndex:s,path:i,customParameters:n,apiKey:a,signal:l}){if(t==null)throw new b(`${r}:no-cached-statistics`,"Cached statistics are not available for this layer");const u=s.get(e);if(u==null)throw new b(`${r}:field-unexisting`,`Field '${e}' does not exist on the layer`);const p=t.find(y=>y.name===u.name);if(p==null)throw new b(`${r}:no-cached-statistics`,"Cached statistics for this attribute are not available");const d=Gr(i,p.href),{data:m}=await Ut(d,{query:{f:"json",...n,token:a},responseType:"json",signal:l});return m}async function pn(e){const t=[];for(const r of e)r.name.toLowerCase().endsWith(".zip")?t.push(dn(r)):t.push(Promise.resolve(r));return(await Promise.all(t)).flat()}async function dn(e){const{BlobReader:t,ZipReader:r,BlobWriter:s}=await pe(()=>import("./zipjs-wrapper-srAKUj3Q.js"),[]),i=[];return(await new r(new t(e)).getEntries()).forEach(a=>{var p;if(a.directory||/^__MACOS/i.test(a.filename))return;const l=new s,u=(p=a.getData)==null?void 0:p.call(a,l).then(d=>new File([d],a.filename));u&&i.push(u)}),Promise.all(i)}const hn=new Set(["3DObject","Point"]),At=Zs();let h=class extends ln(Es(Ps(Os(Ds(Ms(kr(is(js(Rs(Ft(ss))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Oe,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}destroy(){this._set("renderer",null),this.associatedLayer=Hr(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var s,i,n;const r=(i=(s=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:s.domains)==null?void 0:i[e];return r&&r.type!=="inherited"?r:((n=this.getField(e))==null?void 0:n.domain)??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){var e;return((e=this.associatedLayer)==null?void 0:e.types)??[]}get typeIdField(){var e;return((e=this.associatedLayer)==null?void 0:e.typeIdField)??null}get templates(){var e;return((e=this.associatedLayer)==null?void 0:e.templates)??null}get formTemplate(){var e;return((e=this.associatedLayer)==null?void 0:e.formTemplate)??null}get attributeTableTemplate(){var e;return((e=this.associatedLayer)==null?void 0:e.attributeTableTemplate)??null}get fieldsIndex(){return new Br(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:er.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){var e;return this._capabilitiesFromAssociatedFeatureLayer((e=this.associatedLayer)==null?void 0:e.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&Hs(this.associatedLayer)}get geometryType(){return fn[this.profile]||"mesh"}set renderer(e){st(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){var e;return this._capabilitiesFromAssociatedFeatureLayer((e=this.associatedLayer)==null?void 0:e.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){var W;e=e??zs;const{query:t,queryRelated:r,editing:{supportsGlobalId:s,supportsRollbackOnFailure:i,supportsUploadWithItemId:n,supportsGeometryUpdate:a,supportsReturnServiceEditsInSourceSpatialReference:l},data:{supportsZ:u,supportsM:p,isVersioned:d,supportsAttachment:m},operations:{supportsEditing:y,supportsAdd:f,supportsUpdate:g,supportsDelete:v,supportsQuery:$,supportsQueryAttachments:A,supportsAsyncConvert3D:x}}=e,w=e.operations.supportsChangeTracking,T=!!((W=this.associatedLayer)!=null&&W.infoFor3D);return{query:t,queryRelated:r,editing:{supportsGlobalId:s,supportsReturnServiceEditsInSourceSpatialReference:l,supportsRollbackOnFailure:i,supportsGeometryUpdate:T&&a,supportsUploadWithItemId:n},data:{supportsAttachment:m,supportsZ:u,supportsM:p,isVersioned:d},operations:{supportsQuery:$,supportsQueryAttachments:A,supportsEditing:y&&w,supportsAdd:T&&f&&w,supportsDelete:T&&v&&w,supportsUpdate:g&&w,supportsAsyncConvert3D:x}}}get editingEnabled(){var e;return this._isOverridden("editingEnabled")?this._get("editingEnabled"):((e=this.associatedLayer)==null?void 0:e.editingEnabled)??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){var e;return((e=this.associatedLayer)==null?void 0:e.infoFor3D)??null}get relationships(){var e;return(e=this.associatedLayer)==null?void 0:e.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){var e;return((e=this.associatedLayer)==null?void 0:e.displayField)??null}readProfile(e,t){const r=t.store.profile;return r!=null&&Lt[r]?Lt[r]:(_.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}get useViewTime(){var e;return((e=this.associatedLayer)==null?void 0:e.useViewTime)??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=e!=null?e.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(Qr),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await oi(this,{origin:"service"},t),st(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){_.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){var t;const e=new Kr;return this.geometryType==="mesh"?(t=this.associatedLayer)!=null&&t.infoFor3D&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const s of r.features)s.layer=this,s.sourceLayer=this;return r})}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){var s;const r=Zr(this.fieldsIndex,await pi(this,di(this)));return ui(((s=this.parsedUrl)==null?void 0:s.path)??"",this.attributeStorageInfo??[],e,t,r,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){const r=await this.queryCachedAttributes(e,[t]);if(!r||r.length===0)throw new b("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const s=new Jr;return s.attributes=r[0],s.layer=this,s.sourceLayer=this,s}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(_.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return ci(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e!=null&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new b("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(ct.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(ct.SAVE,e)}async applyEdits(e,t){const{applyEdits:r}=await pe(()=>import("./editingSupport-COej-R5q.js"),__vite__mapDeps([83,1,2,39,38,33]));let s=t;await this.load();const i=this.associatedLayer;if(!i)throw new b(`${this.type}-layer:not-editable`,"Service is not editable");await i.load();const{globalIdField:n}=i,a=!!i.infoFor3D,l=(s==null?void 0:s.globalIdUsed)??!0;if(a&&n==null)throw new b(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(a&&!l)throw new b(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return it(i.url)&&a&&e.deleteFeatures!=null&&n!=null&&(s={...s,globalIdToObjectId:await Bs(i,e.deleteFeatures,n)}),r(this,i.source,e,s)}async uploadAssets(e,t){if(await this.load(),this.associatedLayer==null)throw new b(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}on(e,t){return super.on(e,t)}async convertMesh(e,t){t??(t={});const r=d=>{throw _.getLogger(this).error(".convertMesh()",d.message),d};await this.load(),this.infoFor3D||r(new b("invalid:layer","SceneLayer has no capability for mesh conversion"));const s=await this.extractAndFilterFiles(e),i=s.reduce((d,m)=>ei(this.infoFor3D,m)?d+1:d,0);i===0&&r(new Ls),i>1&&r(new Fs);const n=this.spatialReference,a=t.location??new M({x:0,y:0,z:0,spatialReference:n}),l=a.spatialReference.isGeographic?"local":"georeferenced",u=an.createWithExternalSource(a,s,{vertexSpace:l,transform:_s(a.spatialReference),unitConversionDisabled:!0}),[p]=await this.uploadAssets([u],{...t,useAssetOrigin:!t.location});return p}async extractAndFilterFiles(e){await this.load();const t=this.infoFor3D;return t?(await pn(e)).filter(r=>ti(t,r)):e}validateLayer(e){if(e.layerType&&!hn.has(e.layerType))throw new b("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,s){let i=!1,n=!1;if(r==null)i=!0,n=!0;else{const a=s&&s.isGeographic;switch(r){case"east-north-up":case"earth-centered":i=!0,n=a;break;case"vertex-reference-frame":i=!0,n=!a;break;default:i=!1}}if(!i)throw new b("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new b("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new b("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){var e,t,r;if(this._fieldUsageInfo={},this.fields)for(const s of this.fields){const i=!!((e=this.attributeStorageInfo)!=null&&e.some(l=>l.name===s.name)),n=!!((r=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&r.some(l=>l&&s.name===l.name)),a={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||n,supportsLayerQuery:n};this._fieldUsageInfo[s.name]=a}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){var t;if(!((t=this.associatedLayer)!=null&&t.fields))return;let e=null;for(const r of this.associatedLayer.fields){const s=this.getField(r.name);s?(!s.domain&&r.domain&&(s.domain=r.domain.clone()),s.editable=r.editable,s.nullable=r.nullable,s.length=r.length):(e||(e=this.fields?this.fields.slice():[]),e.push(r.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],t=nt(this);for(let r=0;r<e.length;r++){const s=e[r],i=this.originIdOf(s),n=this.associatedLayer.originIdOf(s);i<n&&(n===De.SERVICE||n===De.PORTAL_ITEM)&&t.setAtOrigin(s,this.associatedLayer[s],n)}}_applyAssociatedLayerExtentOverride(){var t,r,s;const e=(t=this.associatedLayer)==null?void 0:t.getAtOrigin("fullExtent","service");((r=this.associatedLayer)==null?void 0:r.infoFor3D)==null||!e||!it((s=this.associatedLayer)==null?void 0:s.url)||!hr(this)||nt(this).setAtOrigin("fullExtent",e.clone(),De.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if(["mesh-pyramids","points"].includes(this.profile))try{const{serverUrl:t,layerId:r,portalItem:s}=await Ns(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e}),i=await ii.FeatureLayer();this.associatedLayer=new i({url:t,customParameters:this.customParameters,layerId:r,portalItem:s}),await this.associatedLayer.load()}catch(t){Xr(t)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await Yr(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?_.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):_.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;this.profile==="mesh-pyramids"&&dt(_.getLogger(this),ai("Mesh scene layers","relative-to-scene",e)),dt(_.getLogger(this),li("Scene layers",e))}async fetchStatistics(e,t){var r;return await un({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:((r=this.parsedUrl)==null?void 0:r.path)??"",customParameters:this.customParameters,apiKey:this.apiKey,signal:t==null?void 0:t.signal})}};o([c({types:{key:"type",base:Qs,typeMap:{selection:Ks}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],h.prototype,"featureReduction",void 0),o([c({type:[V],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],h.prototype,"rangeInfos",void 0),o([c({json:{read:!1}})],h.prototype,"associatedLayer",void 0),o([c({type:["show","hide"]})],h.prototype,"listMode",void 0),o([c({type:["ArcGISSceneServiceLayer"]})],h.prototype,"operationalLayerType",void 0),o([c({json:{read:!1},readOnly:!0})],h.prototype,"type",void 0),o([c({...At.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"fields",void 0),o([c()],h.prototype,"types",null),o([c()],h.prototype,"typeIdField",null),o([c()],h.prototype,"templates",null),o([c()],h.prototype,"formTemplate",null),o([c()],h.prototype,"attributeTableTemplate",null),o([c({readOnly:!0,clonable:!1})],h.prototype,"fieldsIndex",null),o([c({type:si,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],h.prototype,"floorInfo",void 0),o([c(At.outFields)],h.prototype,"outFields",void 0),o([c({type:er,readOnly:!0,json:{read:!1}})],h.prototype,"nodePages",void 0),o([k("service","nodePages",["nodePages","pointNodePages"])],h.prototype,"readNodePages",null),o([c({type:[Js],readOnly:!0})],h.prototype,"materialDefinitions",void 0),o([c({type:[Xs],readOnly:!0})],h.prototype,"textureSetDefinitions",void 0),o([c({type:[Ys],readOnly:!0})],h.prototype,"geometryDefinitions",void 0),o([c({readOnly:!0})],h.prototype,"serviceUpdateTimeStamp",void 0),o([c({readOnly:!0})],h.prototype,"attributeStorageInfo",void 0),o([c({readOnly:!0})],h.prototype,"statisticsInfo",void 0),o([c({type:Oe.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],h.prototype,"excludeObjectIds",void 0),o([c({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],h.prototype,"definitionExpression",void 0),o([c({type:cn,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],h.prototype,"filter",void 0),o([c({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],h.prototype,"path",void 0),o([c(Ws)],h.prototype,"elevationInfo",null),o([c({readOnly:!0,json:{read:!1}})],h.prototype,"effectiveCapabilities",null),o([c({readOnly:!0})],h.prototype,"effectiveEditingEnabled",null),o([c({type:String})],h.prototype,"geometryType",null),o([c(qs)],h.prototype,"labelsVisible",void 0),o([c({type:[ri],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:pt},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:pt},write:!0}})],h.prototype,"labelingInfo",void 0),o([c(Vs)],h.prototype,"legendEnabled",void 0),o([c({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var s,i;if(typeof e=="number"&&e>=0&&e<=1)return e;const r=(i=(s=t.layerDefinition)==null?void 0:s.drawingInfo)==null?void 0:i.transparency;return r!==void 0?es(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],h.prototype,"opacity",void 0),o([c({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"priority",void 0),o([c({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"semantic",void 0),o([c({types:ts,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],h.prototype,"renderer",null),o([c({json:{read:!1}})],h.prototype,"cachedDrawingInfo",void 0),o([k("service","cachedDrawingInfo")],h.prototype,"readCachedDrawingInfo",null),o([c({readOnly:!0,json:{read:!1}})],h.prototype,"capabilities",null),o([c({type:Boolean,json:{read:!1}})],h.prototype,"editingEnabled",null),o([c({readOnly:!0,json:{write:!1,read:!1}})],h.prototype,"infoFor3D",null),o([c({readOnly:!0,json:{write:!1,read:!1}})],h.prototype,"relationships",null),o([c(Gs)],h.prototype,"popupEnabled",void 0),o([c({type:rs,json:{name:"popupInfo",write:!0}})],h.prototype,"popupTemplate",void 0),o([c({readOnly:!0,json:{read:!1}})],h.prototype,"defaultPopupTemplate",null),o([c({type:String,json:{read:!1}})],h.prototype,"objectIdField",void 0),o([k("service","objectIdField",["objectIdField","fields"])],h.prototype,"readObjectIdField",null),o([c({type:String,json:{read:!1}})],h.prototype,"globalIdField",void 0),o([k("service","globalIdField",["globalIdField","fields"])],h.prototype,"readGlobalIdField",null),o([c({readOnly:!0,type:String,json:{read:!1}})],h.prototype,"displayField",null),o([c({type:String,json:{read:!1}})],h.prototype,"profile",void 0),o([k("service","profile",["store.profile"])],h.prototype,"readProfile",null),o([c({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],h.prototype,"normalReferenceFrame",void 0),o([c(ks)],h.prototype,"screenSizePerspectiveEnabled",void 0),o([c({json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"serviceItemId",void 0),o([c(Cs)],h.prototype,"useViewTime",null),h=o([R("esri.layers.SceneLayer")],h);const Lt={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},fn={"mesh-pyramids":"mesh",points:"point"},mn=h,go=Object.freeze(Object.defineProperty({__proto__:null,default:mn},Symbol.toStringTag,{value:"Module"}));export{an as $,go as S,ue as c,ie as f,fi as m,ce as w};
//# sourceMappingURL=SceneLayer-BV-RMp_f.js.map
