const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/layersCreator-BfHJJB9R.js","assets/index-Bs-G_wsu.js","assets/index-D3OSfFaz.css","assets/portalLayers-BdsR0hcD.js","assets/associatedFeatureServiceUtils-6IVjCaHf.js","assets/fetchService-2BwpOoiK.js","assets/portalItemUtils-DwiXoV8_.js","assets/styleUtils-CplkOwlh.js","assets/geometryServiceUtils-DzrAx-Il.js","assets/project-icRd-hca.js","assets/webdocSaveUtils-Dq8s9jpG.js","assets/MultiOriginJSONSupport-BBxe_F7T.js","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/jsonContext-BDIn9Amg.js","assets/basemapUtils-RODjC3R-.js","assets/utils-DzB8n6BG.js","assets/resourceUtils-cEEDuGli.js","assets/uuid-Cl5lrJ4c.js","assets/resourceUtils-B3suAenr.js","assets/saveUtils-DtgTFV4C.js","assets/queryNamedTraceConfigurations-BgetXnrt.js","assets/ColorBackground-CCzJQZw-.js","assets/CollectionFlattener-CTw_eXOA.js","assets/TablesMixin-D5Abru63.js","assets/Layer-BD5fEEcE.js","assets/interfaces-CL2NbQte.js","assets/TimeInfo-BCZiCiBo.js","assets/FeatureLayer-DqQYisns.js","assets/commonProperties-D2JZeGzF.js","assets/ElevationInfo-Ogo5JfE3.js","assets/FeatureLayerBase-DxFxosgr.js","assets/HeightModelInfo-DY5GmORu.js","assets/featureLayerUtils-B9lP5GlN.js","assets/LayerFloorInfo-D23a2fZQ.js","assets/Relationship-C-cZFGat.js","assets/serviceCapabilitiesUtils-GEj5uSHc.js","assets/editsZScale-8PMy8JU4.js","assets/APIKeyMixin-DWFWR-Vn.js","assets/ArcGISService-Dhi-DofJ.js","assets/BlendLayer-BeHYTX5Y.js","assets/jsonUtils-qHdUfL9L.js","assets/parser-DP7rDSW3.js","assets/CustomParametersMixin-Y8anAD7D.js","assets/EditBusLayer-BZlckobr.js","assets/FeatureEffectLayer-CFhteKe0.js","assets/FeatureEffect-27mWUEtN.js","assets/FeatureReductionLayer-C4ahZQSV.js","assets/FeatureReductionSelection-QQOJQw4A.js","assets/labelingInfo-Qff1pGsE.js","assets/labelUtils-BPgYl1Yw.js","assets/MD5-C9MwAd2G.js","assets/OperationalLayer-okMj1Nle.js","assets/OrderedLayer-BJsCVehV.js","assets/OrderByInfo-Dttd1GVs.js","assets/PortalLayer-DHH3dWZi.js","assets/RefreshableLayer-BAKri3Ps.js","assets/ScaleRangeLayer-DoKtR3vt.js","assets/TemporalLayer-Byau-JSW.js","assets/FeatureTemplate-BJHAfJZ2.js","assets/FeatureType-rnXSbOXM.js","assets/fieldProperties-CwoNl49C.js","assets/versionUtils-DuQ7RKEy.js","assets/popupUtils-Cu6PoQ9J.js","assets/AlphaCutoff-UcccL64p.js","assets/NetworkElement-DrdCd9jQ.js","assets/QueryNamedTraceConfigurationsParameters-tby5Bsl6.js","assets/validateNetworkTopology-BzG-DvoS.js","assets/ValidateNetworkTopologyParameters-DxTSesMh.js","assets/queryAssociations-DrrBST0g.js","assets/Association-IyyUx6Tu.js","assets/QueryAssociationsParameters-b0K_RM8K.js","assets/synthesizeAssociationGeometries-DKGdfZov.js","assets/SynthesizeAssociationGeometriesParameters-DbWmk2Qt.js","assets/trace-DvALoZZT.js","assets/TraceParameters-BsqvkF3o.js"])))=>i.map(i=>d[i]);
import{j as r,m as o,k as u,P as y,b8 as Y,M as Ve,eV as he,p as Z,fa as Vt,o as H,u as R,t as st,G as Xt,_,I as ie,s as Re,lp as we,eu as er,bc as K,cc as Ut,ae as rt,cM as tr,j9 as Lt,ex as rr,aG as ir,bb as or,O as B,ar as Pt,lD as sr,ag as Be,f9 as It,hS as nr,f6 as ar,v as lr,ga as pr,eT as Ct,fc as ur,nu as dr,gt as cr,c1 as yr,dK as mr,aN as hr,S as Ge,aa as Ft,U as ge,aC as Gt,x as gr,aT as wr,q as Et,d4 as Bt,bu as Dt,a_ as vr,ew as fr,aY as br,b_ as Ir,bZ as Sr,ff as Tr,fe as jr}from"./index-Bs-G_wsu.js";import{m as St,L as Nr,s as Fe,n as Mt}from"./ColorBackground-CCzJQZw-.js";import{S as Jt,m as Er}from"./MultiOriginJSONSupport-BBxe_F7T.js";import{f as _r}from"./portalItemUtils-DwiXoV8_.js";import{A as Me}from"./interfaces-CL2NbQte.js";import{l as qt,e as $r}from"./TimeInfo-BCZiCiBo.js";import{e as Ar}from"./jsonContext-BDIn9Amg.js";import{p as kr,n as xr}from"./project-icRd-hca.js";import Or from"./FeatureLayer-DqQYisns.js";import{r as Rr}from"./featureLayerUtils-B9lP5GlN.js";import{g as _t,a as nt,l as Vr,h as Ur,t as $t,i as At,c as kt}from"./EditBusLayer-BZlckobr.js";import{t as de,o as Je,p as Lr,c as Pr}from"./NetworkElement-DrdCd9jQ.js";let ne=class extends y{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],ne.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],ne.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],ne.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],ne.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],ne.prototype,"sublayerId",void 0),ne=r([u("esri.layers.support.FacilityLayerInfo")],ne);const Cr=ne;let C=class extends y{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};r([o({type:String,json:{write:!0}})],C.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"levelIdField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"levelNumberField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"longNameField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"shortNameField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],C.prototype,"sublayerId",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"verticalOrderField",void 0),C=r([u("esri.layers.support.LevelLayerInfo")],C);const Fr=C;let ce=class extends y{constructor(t){super(t),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],ce.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],ce.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],ce.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],ce.prototype,"sublayerId",void 0),ce=r([u("esri.layers.support.SiteLayerInfo")],ce);const Gr=ce;let fe=class extends y{constructor(t){super(t),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};r([o({type:Fr,json:{write:!0}})],fe.prototype,"levelLayer",void 0),r([o({type:Cr,json:{write:!0}})],fe.prototype,"facilityLayer",void 0),r([o({type:Gr,json:{write:!0}})],fe.prototype,"siteLayer",void 0),fe=r([u("esri.support.MapFloorInfo")],fe);const Br=fe;var at;let be=at=class extends y{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new at(Y({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};r([o({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],be.prototype,"activeRange",void 0),r([o({type:[Number],json:{write:!0}})],be.prototype,"currentRangeExtent",void 0),r([o({type:[Number],json:{write:!0}})],be.prototype,"fullRangeExtent",void 0),be=at=r([u("esri.webdoc.RangeInfo")],be);const Tt=be;var lt;let J=lt=class extends y{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new lt(Y({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};r([o({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],J.prototype,"enabled",void 0),r([o({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],J.prototype,"longNames",void 0),r([o({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],J.prototype,"minimized",void 0),r([o({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],J.prototype,"pinnedLevels",void 0),r([o({type:String,json:{read:{source:"site"},write:{target:"site"}}})],J.prototype,"site",void 0),r([o({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],J.prototype,"facility",void 0),r([o({type:String,json:{read:{source:"level"},write:{target:"level"}}})],J.prototype,"level",void 0),J=lt=r([u("esri.webdoc.widgets.FloorFilter")],J);const Dr=J;var pt;const qe=new Ve({slider:"slider",picker:"picker"});let Ie=pt=class extends y{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new pt({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};r([o({type:qe.apiValues,nonNullable:!0,json:{type:qe.jsonValues,default:null,read:{reader:qe.read},write:{isRequired:!0,writer:qe.write}}})],Ie.prototype,"interactionMode",void 0),r([o({type:he,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=this.stopInterval!=null;return{enabled:!e,isRequired:!e}}}}})],Ie.prototype,"numStops",void 0),r([o({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],Ie.prototype,"stopInterval",void 0),Ie=pt=r([u("esri.webdoc.widgets.Range")],Ie);const Mr=Ie;var ut;let N=ut=class extends y{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){return e?Z.fromArray(e):void 0}writeCurrentTimeExtent(e,t,i){e&&st(i,e.toArray(),t)}readFullTimeExtent(e,t){const i=t.properties;if(!i)return;const s=i.endTime!=null?new Date(i.endTime):null,n=i.startTime!=null?new Date(i.startTime):null;return new Z({start:n,end:s})}writeFullTimeExtent(e,t){if(!e)return;const i=t.properties=t.properties||{},s=e.end,n=e.start;s&&(i.endTime=s!=null?s.getTime():null),n&&(i.startTime=n!=null?n.getTime():null)}readStopInterval(e,t,i){return e?qt.fromJSON({value:e.interval,unit:e.units},i):null}writeStopInterval(e,t,i,s){if(!e)return;const n=e.toJSON(s);st("properties.timeStopInterval",{interval:n.value,units:n.unit},t)}readStops(e){return e!=null&&e.length?e.map(t=>new Date(t)):null}writeStops(e,t,i){e!=null&&e.length&&st(i,e.map(s=>s.getTime()),t)}clone(){return new ut(Y({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};r([o({type:Z,json:{type:[[he,Vt]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],N.prototype,"currentTimeExtent",void 0),r([H("currentTimeExtent")],N.prototype,"readCurrentTimeExtent",null),r([R("currentTimeExtent")],N.prototype,"writeCurrentTimeExtent",null),r([o({type:Z,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],N.prototype,"fullTimeExtent",void 0),r([H("fullTimeExtent")],N.prototype,"readFullTimeExtent",null),r([R("fullTimeExtent")],N.prototype,"writeFullTimeExtent",null),r([o({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],N.prototype,"loop",void 0),r([o({type:he,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var s;const e=!!this.stopInterval,t=!!((s=this.stops)!=null&&s.length),i=!(e||t);return{enabled:i,isRequired:i}}}}})],N.prototype,"numStops",void 0),r([o({type:[1,2],nonNullable:!0,json:{type:he,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],N.prototype,"numThumbs",void 0),r([o({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],N.prototype,"stopDelay",void 0),r([o({type:qt,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:$r.jsonValues.filter(e=>e!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const e=this.numStops!=null,t=!!((i=this.stops)!=null&&i.length);return{enabled:!t,isRequired:!(e||t)}}}}})],N.prototype,"stopInterval",void 0),r([H("stopInterval")],N.prototype,"readStopInterval",null),r([R("stopInterval")],N.prototype,"writeStopInterval",null),r([o({type:[Date],json:{type:[he],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],N.prototype,"stops",void 0),r([H("stops")],N.prototype,"readStops",null),r([R("stops")],N.prototype,"writeStops",null),N=ut=r([u("esri.webdoc.widgets.TimeSlider")],N);const Jr=N;var dt;let Se=dt=class extends y{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new dt(Y({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};r([o({type:Mr,json:{write:!0}})],Se.prototype,"range",void 0),r([o({type:Jr,json:{write:!0}})],Se.prototype,"timeSlider",void 0),r([o({type:Dr,json:{write:!0}})],Se.prototype,"floorFilter",void 0),Se=dt=r([u("esri.webdoc.Widgets")],Se);const qr=Se,zr={width:600,height:400},ze=1.5;function Wr(e,t){t=t||zr;let{width:i,height:s}=t;const n=i/s;return n<ze?s=i/ze:n>ze&&(i=s*ze),i>e.width&&(s*=e.width/i,i=e.width),s>e.height&&(i*=e.height/s,s=e.height),{width:Math.round(i),height:Math.round(s)}}function Hr(e,t){var i;return t.resourceInfo?zt(t,t.resourceInfo,{origin:e.origin}):(i=t.portalItem)!=null&&i.id?Zr(e,t,t.portalItem):Promise.resolve()}function zt(e,t,i){const s={context:{...i,layerContainerType:"operational-layers"}};return e.portalItem&&(s.context.portal=e.portalItem.portal||Xt.getDefault()),_(()=>import("./layersCreator-BfHJJB9R.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(({populateOperationalLayers:n})=>{const a=[],l=t.operationalLayers;l!=null&&l.length&&a.push(n(e.layers,l,s));const p={...s,context:{...s.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},d=t.tables;return d!=null&&d.length&&a.push(n(e.tables,d,p)),Promise.allSettled(a).then(()=>{})})}async function Zr(e,t,i){var l;if(await i.load().catch(p=>{throw new ie(`${e.name}:load-portal-item`,"Failed to load portal item",{error:p})}),i.type!==e.itemType)throw new ie(`${e.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${e.itemType}'`,{type:i.type});const s=await i.fetchData();t.resourceInfo=s;const n=Ar(i,e.origin);await Kr(e,t,s,n),t.resourceReferences={portalItem:i,paths:n.readResourcePaths};const a=await Qr(t.initialViewProperties,i,Re.getLogger(t));if(a){const p=((l=t.initialViewProperties)==null?void 0:l.clone())??e.createInitialViewProperties();p.viewpoint=a,t.initialViewProperties=p}}function Kr(e,t,i,s){const n=Yr(e,i);return t.read(n,s),zt(t,n,s)}function Yr(e,t){const i=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(i),t.version=`${i.major}.${i.minor}`,t}async function Qr(e,t,i){var a;if((a=e==null?void 0:e.viewpoint)==null?void 0:a.targetGeometry)return null;const n=await Xr(e,t,i);return n?new we({targetGeometry:n}):null}async function Xr(e,t,i){const s=e==null?void 0:e.spatialReference,n=t==null?void 0:t.extent;if(!s||!n)return null;if(s.isWGS84)return n.clone();if(s.isWebMercator)return er(n);const{getGeometryServiceURL:a}=await _(()=>import("./geometryServiceUtils-DzrAx-Il.js"),__vite__mapDeps([8,1,2,9]));try{const l=await a(t),p=new kr({geometries:[n],outSpatialReference:s});return(await xr(l,p))[0]}catch(l){i.error("Error projecting item's extent:",l)}return null}function xt(e){return{enabled:!!(e!=null&&e.length)}}var ct;let Te=ct=class extends y{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new ct({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],Te.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],Te.prototype,"name",void 0),r([K(Ut)],Te.prototype,"type",void 0),Te=ct=r([u("esri.webdoc.applicationProperties.SearchLayerField")],Te);const ei=Te;var yt;let je=yt=class extends y{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new yt(Y({field:this.field,id:this.id,subLayer:this.subLayer}))}};r([o({type:ei,json:{write:{isRequired:!0}}})],je.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],je.prototype,"id",void 0),r([o({type:he,json:{write:!0}})],je.prototype,"subLayer",void 0),je=yt=r([u("esri.webdoc.applicationProperties.SearchLayer")],je);const ti=je;var mt;let Ne=mt=class extends y{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new mt({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],Ne.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],Ne.prototype,"name",void 0),r([K(Ut)],Ne.prototype,"type",void 0),Ne=mt=r([u("esri.webdoc.applicationProperties.SearchTableField")],Ne);const ri=Ne;var ht;let Ue=ht=class extends y{constructor(e){super(e),this.field=null,this.id=null}clone(){return new ht(Y({field:this.field,id:this.id}))}};r([o({type:ri,json:{write:{isRequired:!0}}})],Ue.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],Ue.prototype,"id",void 0),Ue=ht=r([u("esri.webdoc.applicationProperties.SearchTable")],Ue);const ii=Ue;var gt;const Wt=rt.ofType(ti),Ht=rt.ofType(ii);let q=gt=class extends y{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new Wt,this.tables=new Ht}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,i){t[i]=!e}clone(){return new gt(Y({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};r([o({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],q.prototype,"addressSearchEnabled",void 0),r([H("addressSearchEnabled")],q.prototype,"readAddressSearchEnabled",null),r([R("addressSearchEnabled")],q.prototype,"writeAddressSearchEnabled",null),r([o({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],q.prototype,"enabled",void 0),r([o({type:String,json:{write:!0}})],q.prototype,"hintText",void 0),r([o({type:Wt,json:{write:{overridePolicy:xt},origins:{"web-scene":{write:{isRequired:!0}}}}})],q.prototype,"layers",void 0),r([o({type:Ht,json:{read:!0,write:{overridePolicy:xt}}})],q.prototype,"tables",void 0),q=gt=r([u("esri.webdoc.applicationProperties.Search")],q);const oi=q;var wt;let Ye=wt=class extends y{constructor(e){super(e),this.search=null}clone(){return new wt(Y({search:this.search}))}};r([o({type:oi,json:{write:!0}})],Ye.prototype,"search",void 0),Ye=wt=r([u("esri.webdoc.applicationProperties.Viewing")],Ye);const si=Ye;var vt;let Ee=vt=class extends y{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new vt(Y({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};r([o({json:{write:!0}})],Ee.prototype,"editing",void 0),r([o({json:{write:!0}})],Ee.prototype,"offline",void 0),r([o({type:si,json:{write:!0}})],Ee.prototype,"viewing",void 0),Ee=vt=r([u("esri.webmap.ApplicationProperties")],Ee);const ni=Ee;var ft;let re=ft=class extends y{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return tr(this.url)}get isDataURI(){return Lt(this.url)}clone(){return new ft({url:this.url})}};r([o({type:String,json:{write:{isRequired:!0}}})],re.prototype,"url",void 0),r([o()],re.prototype,"isSecureUrl",null),r([o()],re.prototype,"isDataURI",null),re=ft=r([u("esri.webdoc.support.SlideThumbnail")],re);const ai={type:Z,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?Z.fromArray(e):Z.fromJSON(e):null},write:{writer:(e,t,i,s)=>{e&&(e.isEmpty?s!=null&&s.messages&&s.messages.push(new ie("invalid-timeExtent","TimeExtent cannot be empty")):t[i]=e.toArray())},target:{timeExtent:{type:[[he,Vt]]}}}}};var bt;let z=bt=class extends rr(y){constructor(e){super(e),this.name=null,this.thumbnail=new re,this.timeExtent=null}castThumbnail(e){return typeof e=="string"?new re({url:e}):ir(re,e)}set viewpoint(e){const{targetGeometry:t,scale:i}=e;t!=null&&t.type==="point"&&i==null&&Re.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:i,viewpoint:s}=t;return we.fromJSON(s||{targetGeometry:i})}writeViewpoint(e,t,i,s){if(!e)return;const{targetGeometry:n}=e;if(n==null||n.type==="extent")n!=null&&(t.extent=n.toJSON()),t[i]=e.toJSON();else{const a="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";s!=null&&s.messages?s.messages.push(new ie("property:unsupported",a)):Re.getLogger(this).error(a)}}clone(){return new bt(Y({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};r([o({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],z.prototype,"name",void 0),r([o({type:re,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],z.prototype,"thumbnail",void 0),r([or("thumbnail")],z.prototype,"castThumbnail",null),r([o(ai)],z.prototype,"timeExtent",void 0),r([o({type:we,nonNullable:!0,json:{write:!0}})],z.prototype,"viewpoint",null),r([H("viewpoint",["extent","viewpoint"])],z.prototype,"readViewpoint",null),r([R("viewpoint")],z.prototype,"writeViewpoint",null),z=bt=r([u("esri.webmap.Bookmark")],z);const li=z;let X=class extends B(Pt){constructor(t){super(t),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=sr,this.viewpoint=null}};r([o({type:St})],X.prototype,"background",void 0),r([o({type:Tt})],X.prototype,"rangeInfo",void 0),r([o({type:Be})],X.prototype,"spatialReference",void 0),r([o({type:Z})],X.prototype,"timeExtent",void 0),r([o({nonNullable:!0})],X.prototype,"timeZone",void 0),r([o({type:we})],X.prototype,"viewpoint",void 0),X=r([u("esri.webmap.InitialViewProperties")],X);const tt=X,Zt=rt.ofType(li),pi=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),ui="ArcGIS Pro",di=_r.JSAPI;let h=class extends Jt(It.LoadableMixin(nr(Nr))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new Zt,this.floorInfo=null,this.initialViewProperties=new tt,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=ar(async(t,i,s)=>{const{save:n,saveAs:a}=await _(()=>import("./webdocSaveUtils-Dq8s9jpG.js"),__vite__mapDeps([10,1,2,11,12,13,14,6,9,15,16,17,18,19,20]));switch(t){case Me.SAVE:return n(this.context,this,i);case Me.SAVE_AS:return a(this.context,this,s,i)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=lr(this.portalItem)}initialize(){if(this.when().catch(e=>{Re.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=di}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=pr}readInitialViewProperties(e,t){var a,l;const i=new tt;t.background&&(i.background=St.fromJSON(t.background));const s=(a=t.initialState)==null?void 0:a.timeExtent;s&&(i.timeExtent=Z.fromArray(s));const n=(l=t.initialState)==null?void 0:l.viewpoint;return n&&(n.rotation&&Fe.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===ui&&(n.rotation*=-1),i.viewpoint=we.fromJSON(n)),t.mapRangeInfo&&(i.rangeInfo=Tt.fromJSON(t.mapRangeInfo)),t.spatialReference&&(i.spatialReference=Be.fromJSON(t.spatialReference)),t.timeZone&&(i.timeZone=t.timeZone),i}writeInitialViewProperties(e,t,i,s){var l;if(!e)return;(l=e.background)!=null&&l.color&&(t.background=e.background.write({},s));const{timeExtent:n,viewpoint:a}=e;if(a||n){const p={};a&&(p.viewpoint=a.write({},s)),n&&(p.timeExtent=n.toArray()),t.initialState=p}e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},s)),t.timeZone=e.timeZone}writeLayers(e,t,i,s){t[i]=this._writeLayers(e,s,"operational-layers")}readSourceVersion(e,t){const[i,s]=t.version.split(".");return new Fe(parseInt(i,10),parseInt(s,10))}writeSourceVersion(e,t,i){t[i]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,t,i,s){const n=this._writeLayers(e,s,"tables");n.length&&(t[i]=n)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(Hr(this.context,this)),Promise.resolve(this)}loadAll(){return Ct(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,t){t={...t,origin:this.context.origin};const i=this._getAuthoringPropsState();ur(this,e,s=>super.read(e,s),t),this._restoreAuthoringPropsFromState(i)}write(e,t){if(this.loadStatus!=="loaded"){const i=new ie("webmap:not-loaded","Web map must be loaded before it can be serialized");throw Re.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),i}return this._removeDanglingLayerRefs(),t={...t,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(Me.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Me.SAVE_AS,t,e)}async updateFrom(e,t){const i=this._updateFromInternal(e,t);this._updateFromPromise=i,await i,i===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){var i,s,n,a;const t=this.resourceInfo;return this._collectAllLayersJSON([...((i=t==null?void 0:t.baseMap)==null?void 0:i.baseMapLayers)||[],...(t==null?void 0:t.operationalLayers)||[],...((a=(n=(s=this.basemap)==null?void 0:s.resourceInfo)==null?void 0:n.data)==null?void 0:a.baseMapLayers)||[]]).find(l=>l.id===e.id)}async updateItemThumbnail(){var e;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:dr(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((t,i)=>(t.push(i),i.layerType==="GroupLayer"&&(t=t.concat(this._collectAllLayersJSON(i.layers||[]))),t),[])}_writeLayers(e,t,i){return t={...t,layerContainerType:i},e.map(s=>cr(s,i==="tables"?null:this.getLayerJSONFromResourceInfo(s),t)).filter(yr).toArray()}_validateJSON(e){const t=Fe.parse(e.version||"","webmap");return this.context.currentVersion.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){var a,l;const e=this.applicationProperties,t=(a=e==null?void 0:e.viewing)==null?void 0:a.search,i=p=>this.allLayers.some(d=>d.id===p);if(t!=null&&t.layers&&(t.layers=t.layers.filter(p=>i(p.id))),t!=null&&t.tables&&(t.tables=t.tables.filter(p=>this.tables.some(d=>d.id===p.id))),e){const p=(l=e.editing)==null?void 0:l.locationTracking;p!=null&&p.info&&!i(p.info.layerId)&&(e.editing=null)}const s="presentation"in this?this.presentation:null,n=s==null?void 0:s.slides;n&&n.forEach(p=>{p.visibleLayers&&(p.visibleLayers=p.visibleLayers.filter(d=>i(d.id)))})}async _updateFromInternal(e,t){if(t??(t={}),await mr(()=>e.ready),this._updateInitialViewProperties(e,t),e.map===this)for(const i of e.allLayerViews)"visible"in i&&"visible"in i.layer&&i._isOverridden("visible")&&(i.layer.visible=i.visible),"featureEffect"in i&&"featureEffect"in i.layer&&i._isOverridden("featureEffect")&&(i.layer.featureEffect=i.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){var i,s;if(t.backgroundExcluded||(this.initialViewProperties.background=(i=e.background)==null?void 0:i.clone()),this.initialViewProperties.spatialReference=(s=e.spatialReference)==null?void 0:s.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new we({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),i=e.extent.clone(),s=i.width/2;return i.xmin=t.x-s,i.xmax=t.x+s,i}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const i=Wr(e,t.thumbnailSize),s=await e.takeScreenshot({format:"png",width:i.width,height:i.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(Lt(e)){const t=hr(e),i=t==null?void 0:t.mediaType,s=i&&pi.get(i.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};r([o()],h.prototype,"_updateFromPromise",void 0),r([o({type:ni,json:{write:!0}})],h.prototype,"applicationProperties",void 0),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],h.prototype,"authoringApp",null),r([R("authoringApp")],h.prototype,"writeAuthoringApp",null),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],h.prototype,"authoringAppVersion",null),r([R("authoringAppVersion")],h.prototype,"writeAuthoringAppVersion",null),r([o({type:Zt,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],h.prototype,"bookmarks",void 0),r([o({type:Br,json:{name:"mapFloorInfo",write:!0}})],h.prototype,"floorInfo",void 0),r([o({type:tt,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:St},"initialState.timeExtent":{type:Z},"initialState.viewpoint":{type:we},mapRangeInfo:{type:Tt},spatialReference:{type:Be},"timeZone:":{type:String}}}}})],h.prototype,"initialViewProperties",void 0),r([H("initialViewProperties")],h.prototype,"readInitialViewProperties",null),r([R("initialViewProperties")],h.prototype,"writeInitialViewProperties",null),r([o({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],h.prototype,"layers",void 0),r([R("layers")],h.prototype,"writeLayers",null),r([o({type:Ge})],h.prototype,"portalItem",void 0),r([o()],h.prototype,"resourceInfo",void 0),r([o({readOnly:!0,type:Fe,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],h.prototype,"sourceVersion",void 0),r([H("sourceVersion")],h.prototype,"readSourceVersion",null),r([R("sourceVersion")],h.prototype,"writeSourceVersion",null),r([o({json:{read:!1,write:{ignoreOrigin:!0}}})],h.prototype,"tables",void 0),r([R("tables")],h.prototype,"writeTables",null),r([o()],h.prototype,"thumbnailUrl",null),r([o()],h.prototype,"updatingFromView",null),r([o({type:qr,json:{write:!0}})],h.prototype,"widgets",void 0),h=r([u("esri.WebDocument2D")],h);const ci=h;let W=class extends y{constructor(t){super(t),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],W.prototype,"moment",void 0),r([o({type:Boolean,json:{write:!0}})],W.prototype,"fullUpdate",void 0),r([o({type:Boolean,json:{write:!0}})],W.prototype,"validateErrorsCreated",void 0),r([o({type:Number,json:{write:!0}})],W.prototype,"dirtyAreaCount",void 0),r([o({type:Boolean,json:{write:!0}})],W.prototype,"exceededTransferLimit",void 0),r([o({type:[Object],json:{write:!0}})],W.prototype,"serviceEdits",void 0),r([o({type:[Object],json:{write:!0}})],W.prototype,"discoveredSubnetworks",void 0),W=r([u("esri.rest.networks.support.ValidateNetworkTopologyResult")],W);const yi=W,mi=Ft()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let ae=class extends yi{constructor(t){super(t),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const i={...t,query:{f:"json"}},{data:s}=await ge(this.statusUrl,i);return this.read(s),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(t={}){const{interval:i=1e3,statusCallback:s}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(Gt()),this.checkJobStatus().then(p=>{const{status:d}=p;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":s&&s(this)}},p=>{this._clearTimer(),a(p)})},i);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};r([o()],ae.prototype,"editsResolver",void 0),r([o({type:String,json:{write:!0}})],ae.prototype,"statusUrl",void 0),r([K(mi)],ae.prototype,"status",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],ae.prototype,"submissionTime",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],ae.prototype,"lastUpdatedTime",void 0),ae=r([u("esri.networks.support.TopologyValidationJobInfo")],ae);const hi=ae;async function Ot(e,t){if(e==="Utility Network Layer"){const{default:i}=await _(()=>Promise.resolve().then(()=>Ai),void 0);return new i({layerUrl:t})}return null}async function gi(e){var l;let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof Ge||(t={...t,portalItem:new Ge(t.portalItem)});const i=t.portalItem;if(await i.load(),i.type!=="Feature Service")throw new ie("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const s=i.url,n=await ge(s,{responseType:"json",query:{f:"json"}}),a="Network Layer";if((l=n.data.type)!=null&&l.includes(a))return Ot(n.data.type,s);if(n.data.layers){const p=n.data.layers.find(d=>d.type.includes(a));if(p){const d=`${s}/${p.id}`;return Ot(p.type,d)}}return null}let f=class extends Jt(It){static fromPortalItem(e){return gi(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=t=>{const{serviceUrl:i,gdbVersion:s,result:n}=t,a=i===this.featureServiceUrl,l=_t(i,s,this.gdbVersion);a&&l&&n.then(p=>{nt(i,s)&&(this.historicMoment=p.historicMoment)})},this._updateMomentHandler=t=>{const{serviceUrl:i,gdbVersion:s,moment:n}=t,a=i===this.featureServiceUrl,l=_t(i,s,this.gdbVersion);a&&l&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([Vr(this._applyEditsHandler),Ur(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{gr(e)||Re.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get datasetName(){var e;return((e=this.dataElement)==null?void 0:e.name)??null}get owner(){var e;return((e=this.dataElement)==null?void 0:e.userIdentity)??null}get schemaGeneration(){var e;return((e=this.dataElement)==null?void 0:e.schemaGeneration)??null}get parsedUrl(){return wr(this.layerUrl)}get featureServiceUrl(){return Et(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return Et(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(!this.dataElement)return null;const t=this._layerIdBySourceId.get(e);if(t!=null)return t;const i=this.dataElement.domainNetworks,s=this._traverseNetworkSources(i,this._layerIdBySourceId,"sourceId","layerId",e);return s>=0?s:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const t=this._sourceIdByLayerId.get(e);if(t!=null)return t;const i=this.dataElement.domainNetworks,s=this._traverseNetworkSources(i,this._sourceIdByLayerId,"layerId","sourceId",e);return s>=0?s:null}getObjectIdsFromElements(e){const t=[],i=new Map;for(const n of e){const a=this.getLayerIdBySourceId(n.networkSourceId);if(a==null)continue;let l=i.get(a);l===void 0&&(l=[]),l.push(n.objectId),i.set(a,l)}const s=this.featureServiceUrl;return i.forEach((n,a)=>t.push({layerUrl:`${s}/${a}`,objectIds:n})),t}async queryNamedTraceConfigurations(e,t){var l;const[{queryNamedTraceConfigurations:i},{default:s}]=await Promise.all([_(()=>import("./queryNamedTraceConfigurations-BgetXnrt.js"),__vite__mapDeps([21,1,2,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64,65])),_(()=>import("./QueryNamedTraceConfigurationsParameters-tby5Bsl6.js"),__vite__mapDeps([66,1,2]))]),n=this.networkServiceUrl,a=s.from(e);return(l=await i(n,a,{...t}))==null?void 0:l.namedTraceConfigurations}async validateTopology(e,t){var v,b,I;if(!e.validateArea)throw new ie("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:i},{default:s}]=await Promise.all([_(()=>import("./validateNetworkTopology-BzG-DvoS.js"),__vite__mapDeps([67,1,2,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64,65])),_(()=>import("./ValidateNetworkTopologyParameters-DxTSesMh.js"),__vite__mapDeps([68,1,2,65]))]),n=s.from(e);nt(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=$t,await At(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const a=this.networkServiceUrl,l=this.featureServiceUrl,p=kt(l,null,this.gdbVersion,!0),d=await i(a,n,{...t});if(d!=null&&d.serviceEdits){const g=[];for(const S of d.serviceEdits){const{editedFeatures:m}=S,c=m!=null&&m.spatialReference?new Be(m.spatialReference):null;g.push({layerId:S.layerId,editedFeatures:{adds:((v=m==null?void 0:m.adds)==null?void 0:v.map(T=>We(T,c)))||[],updates:((b=m==null?void 0:m.updates)==null?void 0:b.map(T=>({original:We(T[0],c),current:We(T[1],c)})))||[],deletes:((I=m==null?void 0:m.deletes)==null?void 0:I.map(T=>We(T,c)))||[],spatialReference:c}})}p.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:g,exceededTransferLimit:!1,historicMoment:d.moment})}return d}async submitTopologyValidationJob(e,t){let i=null;if(!e.validateArea)throw new ie("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const v=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");i=(await ge(v,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:s},{default:n}]=await Promise.all([_(()=>import("./validateNetworkTopology-BzG-DvoS.js"),__vite__mapDeps([67,1,2,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64,65])),_(()=>import("./ValidateNetworkTopologyParameters-DxTSesMh.js"),__vite__mapDeps([68,1,2,65]))]),a=n.from(e);nt(this.featureServiceUrl,this.gdbVersion||null)?(a.sessionID=$t,await At(this.featureServiceUrl,this.gdbVersion,!0)):a.sessionID=null,a.gdbVersion=this.gdbVersion||i;const l=this.networkServiceUrl,p=this.featureServiceUrl?kt(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,d=await s(l,a,{...t});return new hi({statusUrl:d,editsResolver:p})}_traverseNetworkSources(e,t,i,s,n){for(const a of e)for(const l of[a.edgeSources??[],a.junctionSources??[]])for(const p of l)if(p[i]===n)return t.set(n,p[s]),p[s];return-1}async _fetchLayerMetaData(e,t){const i=await ge(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=i.data,this.read(i.data,{origin:"service"})}async _fetchDataElement(e,t,i){if(this.dataElement)return;const s=await ge(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(n=>{var a;return(a=n.data.layerDataElements)==null?void 0:a[0]});s&&this.read(s,{origin:"service"})}};function We(e,t){return new Bt({attributes:e.attributes,geometry:Dt({...e.geometry,spatialReference:t})})}r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],f.prototype,"id",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],f.prototype,"title",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],f.prototype,"layerUrl",void 0),r([o({type:Object,json:{origins:{service:{read:!0}},read:!1}})],f.prototype,"dataElement",void 0),r([o({type:vr,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],f.prototype,"fullExtent",void 0),r([o({type:Be,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],f.prototype,"spatialReference",void 0),r([o({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],f.prototype,"type",void 0),r([o({readOnly:!0})],f.prototype,"datasetName",null),r([o({readOnly:!0})],f.prototype,"owner",null),r([o({readOnly:!0})],f.prototype,"schemaGeneration",null),r([o({readOnly:!0})],f.prototype,"parsedUrl",null),r([o({readOnly:!0})],f.prototype,"featureServiceUrl",null),r([o({readOnly:!0})],f.prototype,"networkServiceUrl",null),r([o({readOnly:!0})],f.prototype,"layerId",null),r([o()],f.prototype,"sourceJSON",void 0),r([o({readOnly:!0})],f.prototype,"networkSystemLayers",null),r([o()],f.prototype,"gdbVersion",void 0),r([o({type:Date})],f.prototype,"historicMoment",void 0),f=r([u("esri.networks.Network")],f);const wi=f;let le=class extends fr(It){constructor(t){super(t),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=ge}initialize(){}async load(t){const i=this.layer.load(t).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeatureSQL(t,i){var v,b;const s=t.layerId.toString(),n=(v=t.fieldsIndex)==null?void 0:v.normalizeFieldName("assetGroup"),a=(b=t.fieldsIndex)==null?void 0:b.normalizeFieldName("assetType"),l=n?i.attributes[n]:null,p=a?i.attributes[a]:null,d=this.rulesHash[s];if(d){const I=d.assetGroupHash[l];if(I)return I.assetTypeHash[p]||null}return null}async _initializeRulesTable(){var n,a,l,p,d,v,b,I,g,S,m;const t={};let i;(function(c){c[c.from=0]="from",c[c.to=1]="to",c[c.via=2]="via"})(i||(i={}));const s=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const c of this.rules){if(c.ruleType===de.RTAttachment){this.rulesCategorized.attachment.push(c);continue}if(c.ruleType===de.RTContainment){this.rulesCategorized.containment.push(c);continue}if(c.ruleType===de.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(c);continue}this.rulesCategorized.connectivity.push(c);let T=[[i.from,i.to],[i.to,i.from]];c.ruleType===de.RTEdgeJunctionEdgeConnectivity&&(T=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const D of T){const M=D.shift(),ve=D.shift();let oe=!1;switch(c.ruleType){case de.RTEdgeJunctionEdgeConnectivity:oe=M===i.from||M===i.to;break;case de.RTJunctionEdgeConnectivity:oe=M===i.to}const k=s[M],j=((n=c[k.networkSourceId])==null?void 0:n.layerId.toString())??"",E=(l=(a=c[k.assetGroupId])==null?void 0:a.assetGroupCode)==null?void 0:l.toString(),L=c[k.assetTypeId],V=(p=L==null?void 0:L.assetTypeCode)==null?void 0:p.toString(),P=s[ve],x=((d=c[P.networkSourceId])==null?void 0:d.layerId.toString())??"",Q=(b=(v=c[P.assetGroupId])==null?void 0:v.assetGroupCode)==null?void 0:b.toString(),$=c[P.assetTypeId],se=(I=$==null?void 0:$.assetTypeCode)==null?void 0:I.toString(),it=t[j]??{assetGroupHash:{}};if(!(E&&V&&Q&&se))continue;const ot=it.assetGroupHash[E]??{assetTypeHash:{}},A=ot.assetTypeHash[V]??{};if(A[x]=A[x]??{},oe){A[j]=A[j]??{};const Nt=`(assetgroup = ${E} AND assettype = ${V})`;($==null?void 0:$.connectivityPolicy)==="esriNECPEndVertex"?A[j].endVertex=(g=A[j])!=null&&g.endVertex?`${A[j].endVertex}`:`${Nt}`:A[j].anyVertex=A[j].anyVertex?`${A[j].anyVertex}`:`${Nt}`}const De=`(assetgroup = ${Q} AND assettype = ${se})`;($==null?void 0:$.connectivityPolicy)==="esriNECPEndVertex"?A[x].endVertex=(S=A[x])!=null&&S.endVertex?`${A[x].endVertex} OR ${De}`:`${De}`:A[x].anyVertex=(m=A[x])!=null&&m.anyVertex?`${A[x].anyVertex} OR ${De}`:`${De}`,ot.assetTypeHash[V]=A,it.assetGroupHash[E]=ot,t[j]=it}}this.rulesHash=t}};r([o({constructOnly:!0})],le.prototype,"layer",void 0),r([o({constructOnly:!0})],le.prototype,"rules",void 0),r([o()],le.prototype,"rulesHash",void 0),r([o()],le.prototype,"rulesCategorized",void 0),r([o({constructOnly:!0})],le.prototype,"request",void 0),le=r([u("esri.networks.RulesTable")],le);const vi=le;let U=class extends y{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};r([o({type:[Object],json:{write:!0}})],U.prototype,"conditionBarriers",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"outputConditions",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"functions",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"functionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],U.prototype,"traversabilityScope",void 0),r([o({type:String,json:{write:!0}})],U.prototype,"shortestPathNetworkAttributeName",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"includeBarriers",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"validateConsistency",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"ignoreBarriersAtStartingPoints",void 0),U=r([u("esri.networks.support.TraceConfiguration")],U);const jt=U;let w=class extends jt{constructor(t){super(t),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};r([o({type:[Object],json:{write:!0}})],w.prototype,"filterBarriers",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"arcadeExpressionBarrier",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"domainNetworkName",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"filterBitsetNetworkAttributeName",void 0),r([o({type:[Object],json:{write:!0}})],w.prototype,"filterFunctionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],w.prototype,"filterScope",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"includeContainers",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"includeContent",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"includeIsolated",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"includeStructures",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"allowIndeterminateFlow",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"includeUpToFirstSpatialContainer",void 0),r([o({type:Object,json:{write:!0}})],w.prototype,"nearestNeighbor",void 0),r([o({type:[Object],json:{write:!0}})],w.prototype,"outputFilterCategories",void 0),r([o({type:[Object],json:{write:!0}})],w.prototype,"outputFilters",void 0),r([o({type:[Object],json:{write:!0}})],w.prototype,"propagators",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"subnetworkName",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"targetTierName",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"diagramTemplateName",void 0),r([o({type:String,json:{write:!0}})],w.prototype,"tierName",void 0),r([o({type:Boolean,json:{write:!0}})],w.prototype,"validateLocatability",void 0),w=r([u("esri.networks.support.UNTraceConfiguration")],w);const fi=w;let O=class extends Er{constructor(t){super(t),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(t,i){return t.tierName!==void 0?fi.fromJSON(t):jt.fromJSON(t)}};r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],O.prototype,"globalId",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],O.prototype,"title",void 0),r([o({type:jt,json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"traceConfiguration",void 0),r([H("service","traceConfiguration")],O.prototype,"readTraceConfiguration",null),r([o({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"creationDate",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"creator",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"description",void 0),r([o({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],O.prototype,"minStartingPoints",void 0),r([o({json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"resultTypes",void 0),r([o({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],O.prototype,"tags",void 0),r([o({type:Je.apiValues,json:{type:Je.jsonValues,origins:{service:{read:Je.read,write:Je.write}},read:!1}})],O.prototype,"traceType",void 0),O=r([u("esri.networks.support.NamedTraceConfiguration")],O);const bi=O;let F=class extends Pt{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTableId=null,this.associationsTableUrl=null}};r([o({constructOnly:!0})],F.prototype,"rulesTableId",void 0),r([o({constructOnly:!0})],F.prototype,"rulesTableUrl",void 0),r([o({constructOnly:!0})],F.prototype,"subnetworksTableId",void 0),r([o({constructOnly:!0})],F.prototype,"subnetworksTableUrl",void 0),r([o({constructOnly:!0})],F.prototype,"dirtyAreasLayerId",void 0),r([o({constructOnly:!0})],F.prototype,"dirtyAreasLayerUrl",void 0),r([o({constructOnly:!0})],F.prototype,"associationsTableId",void 0),r([o({constructOnly:!0})],F.prototype,"associationsTableUrl",void 0),F=r([u("esri.networks.support.NetworkSystemLayers")],F);const Ii=F;let _e=class extends y{constructor(t){super(t),this.id=null,this.name=null}};r([o({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],_e.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],_e.prototype,"name",void 0),r([o({type:Boolean,json:{write:!0}})],_e.prototype,"isUpstreamTerminal",void 0),_e=r([u("esri.networks.support.Terminal")],_e);const Si=_e,He=new Ve({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let pe=class extends y{constructor(t){super(t),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};r([o({type:String,json:{write:!0}})],pe.prototype,"defaultConfiguration",void 0),r([o({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],pe.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],pe.prototype,"name",void 0),r([o({type:[Si],json:{write:!0}})],pe.prototype,"terminals",void 0),r([o({type:He.apiValues,json:{type:He.jsonValues,read:He.read,write:He.write}})],pe.prototype,"traversabilityModel",void 0),pe=r([u("esri.networks.support.TerminalConfiguration")],pe);const Rt=pe;let $e=class extends y{constructor(t){super(t),this.line=null,this.multipoint=null,this.polygon=null}};r([o({type:br,json:{write:!0},readOnly:!0})],$e.prototype,"line",void 0),r([o({type:Ir,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],$e.prototype,"multipoint",void 0),r([o({type:Sr,json:{write:!0},readOnly:!0})],$e.prototype,"polygon",void 0),$e=r([u("esri.rest.networks.support.AggregatedGeometry")],$e);const Ti=$e;let Ae=class extends y{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};r([o({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],Ae.prototype,"functionType",void 0),r([o({type:String,json:{write:!0},readOnly:!0})],Ae.prototype,"networkAttributeName",void 0),r([o({type:Number,json:{write:!0},readOnly:!0})],Ae.prototype,"result",void 0),Ae=r([u("esri.rest.networks.support.FunctionResult")],Ae);const ji=Ae;let ee=class extends y{constructor(t){super(t),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};r([o({type:Ti,json:{write:!0},readOnly:!0})],ee.prototype,"aggregatedGeometry",void 0),r([o({type:[Lr],json:{write:!0},readOnly:!0})],ee.prototype,"elements",void 0),r([o({type:[ji],json:{write:!0},readOnly:!0})],ee.prototype,"globalFunctionResults",void 0),r([o({type:Boolean,json:{write:!0},readOnly:!0})],ee.prototype,"kFeaturesForKNNFound",void 0),r([o({type:Boolean,json:{write:!0},readOnly:!0})],ee.prototype,"startingPointsIgnored",void 0),r([o({type:[String],json:{write:!0},readOnly:!0})],ee.prototype,"warnings",void 0),ee=r([u("esri.rest.networks.support.TraceResult")],ee);const Ni=ee,Ei=Ft()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let ye=class extends Ni{constructor(t){super(t),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const i={...t,query:{f:"json"}},{data:s}=await ge(this.statusUrl,i),n=s.traceResults?{...s.traceResults,...s}:s;return this.read(n),this}async waitForJobCompletion(t={}){const{interval:i=1e3,statusCallback:s}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(Gt()),this.checkJobStatus().then(p=>{const{status:d}=p;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":s&&s(this)}},p=>{this._clearTimer(),a(p)})},i);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};r([o({type:String,json:{write:!0}})],ye.prototype,"statusUrl",void 0),r([K(Ei)],ye.prototype,"status",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],ye.prototype,"submissionTime",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],ye.prototype,"lastUpdatedTime",void 0),ye=r([u("esri.networks.support.TraceJobInfo")],ye);const _i=ye;let te=class extends wi{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){var e;return((e=this.dataElement)==null?void 0:e.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var e,t,i,s,n,a,l,p;return new Ii({rulesTableId:(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(t=this.sourceJSON)==null?void 0:t.systemLayers.rulesTableId}`:null,subnetworksTableId:(i=this.sourceJSON)==null?void 0:i.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(s=this.sourceJSON)==null?void 0:s.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(n=this.sourceJSON)==null?void 0:n.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(a=this.sourceJSON)==null?void 0:a.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:(l=this.sourceJSON)==null?void 0:l.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(p=this.sourceJSON)==null?void 0:p.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){var e;return((e=this.dataElement)==null?void 0:e.terminalConfigurations.map(t=>Rt.fromJSON(t)))||[]}get domainNetworkNames(){var e;return((e=this.dataElement)==null?void 0:e.domainNetworks.map(t=>t.domainNetworkName))||[]}get _utilityLayerList(){var t,i;const e=new Set;return(i=(t=this.dataElement)==null?void 0:t.domainNetworks)==null||i.map(s=>{s.edgeSources.map(n=>{e.add(n.layerId)}),s.junctionSources.map(n=>{e.add(n.layerId)})}),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){var d,v,b,I;let t=null,i=null;const s=e.layer;let n=null;if((s==null?void 0:s.type)==="feature"){if(n=s.layerId,n===null)return null}else if((s==null?void 0:s.type)!=="subtype-sublayer"||(n=((d=s==null?void 0:s.parent)==null?void 0:d.layerId)??null,n===null))return null;const a=e.attributes;if(a==null)return null;for(const g of Object.keys(a))g.toUpperCase()==="ASSETGROUP"&&(t=e.getAttribute(g)),g.toUpperCase()==="ASSETTYPE"&&(i=e.getAttribute(g));if(!this.dataElement)return null;let l=null;const p=this.dataElement.domainNetworks;for(const g of p){const S=(v=g.junctionSources)==null?void 0:v.find(m=>m.layerId===n);if(S){const m=(b=S.assetGroups)==null?void 0:b.find(c=>c.assetGroupCode===t);if(m){const c=(I=m.assetTypes)==null?void 0:I.find(T=>T.assetTypeCode===i);if(c){l=c.terminalConfigurationId;break}}}}if(l!=null){const g=this.dataElement.terminalConfigurations,S=g==null?void 0:g.find(m=>m.terminalConfigurationId===l);return S?Rt.fromJSON(S):null}return null}getTierNames(e){var i;const t=(i=this.dataElement)==null?void 0:i.domainNetworks.find(s=>s.domainNetworkName===e);return(t==null?void 0:t.tiers.map(s=>s.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(e){if(!this.dataElement||e==null)return null;const t=this._terminalById.get(e);return t??(this.terminalConfigurations.forEach(i=>{i.terminals.forEach(s=>{this._terminalById.set(s.id,s)})}),this._terminalById.get(e))}isUtilityLayer(e){var t;return"layerId"in e&&this._utilityLayerList.has(e.layerId)&&(((t=e.url)==null?void 0:t.startsWith(this.featureServiceUrl))??!1)}async queryAssociations(e){const[{queryAssociations:t},{default:i}]=await Promise.all([_(()=>import("./queryAssociations-DrrBST0g.js"),__vite__mapDeps([69,1,2,65,70])),_(()=>import("./QueryAssociationsParameters-b0K_RM8K.js"),__vite__mapDeps([71,1,2,65]))]),s=i.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,(await t(this.networkServiceUrl,s)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:t},{default:i}]=await Promise.all([_(()=>import("./synthesizeAssociationGeometries-DKGdfZov.js"),__vite__mapDeps([72,1,2,70,65])),_(()=>import("./SynthesizeAssociationGeometriesParameters-DbWmk2Qt.js"),__vite__mapDeps([73,1,2]))]),s=i.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,t(this.networkServiceUrl,s)}async trace(e){const[{trace:t},{default:i}]=await Promise.all([_(()=>import("./trace-DvALoZZT.js"),__vite__mapDeps([74,1,2,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64,65])),_(()=>import("./TraceParameters-BsqvkF3o.js"),__vite__mapDeps([75,1,2,65,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64]))]),s=i.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,t(this.networkServiceUrl,s)}async submitTraceJob(e){const[{submitTraceJob:t},{default:i}]=await Promise.all([_(()=>import("./trace-DvALoZZT.js"),__vite__mapDeps([74,1,2,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64,65])),_(()=>import("./TraceParameters-BsqvkF3o.js"),__vite__mapDeps([75,1,2,65,22,23,15,16,24,25,11,6,26,27,14,9,28,29,30,31,32,33,18,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,7,63,64]))]),s=i.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;const n=await t(this.networkServiceUrl,s);return new _i({statusUrl:n})}async canAddAssociation(e){const t=await this.getRulesTable();if(!t)return!1;await t.load();const i=(n,a)=>n?n.terminalId===1?!(a!=null&&a.terminalId)||(a==null?void 0:a.terminalId)===n.terminalId:n.terminalId===(a==null?void 0:a.terminalId):!(a!=null&&a.terminalId),s=(n,a)=>{var l,p,d,v,b,I,g,S,m,c,T,D;return((l=n.fromNetworkSource)==null?void 0:l.sourceId)===((p=a.fromNetworkElement)==null?void 0:p.networkSourceId)&&((d=n.toNetworkSource)==null?void 0:d.sourceId)===((v=a.toNetworkElement)==null?void 0:v.networkSourceId)&&((b=n.fromAssetGroup)==null?void 0:b.assetGroupCode)===((I=a.fromNetworkElement)==null?void 0:I.assetGroupCode)&&((g=n.fromAssetType)==null?void 0:g.assetTypeCode)===((S=a.fromNetworkElement)==null?void 0:S.assetTypeCode)&&((m=n.toAssetGroup)==null?void 0:m.assetGroupCode)===((c=a.toNetworkElement)==null?void 0:c.assetGroupCode)&&((T=n.toAssetType)==null?void 0:T.assetTypeCode)===((D=a.toNetworkElement)==null?void 0:D.assetTypeCode)&&i(n.fromTerminal,a.fromNetworkElement)&&i(n.toTerminal,a.toNetworkElement)};return e.associationType==="containment"?t.rulesCategorized.containment.some(n=>s(n,e)):e.associationType==="attachment"?t.rulesCategorized.attachment.some(n=>s(n,e)):t.rulesCategorized.connectivity.some(n=>{var a,l,p,d,v,b,I,g,S,m,c,T,D,M,ve,oe,k,j,E,L,V,P,x,Q;return n.viaNetworkSource?((a=n.fromNetworkSource)==null?void 0:a.sourceId)===((l=e.fromNetworkElement)==null?void 0:l.networkSourceId)&&((p=n.viaNetworkSource)==null?void 0:p.sourceId)===((d=e.toNetworkElement)==null?void 0:d.networkSourceId)&&((v=n.fromAssetGroup)==null?void 0:v.assetGroupCode)===((b=e.fromNetworkElement)==null?void 0:b.assetGroupCode)&&((I=n.fromAssetType)==null?void 0:I.assetTypeCode)===((g=e.fromNetworkElement)==null?void 0:g.assetTypeCode)&&((S=n.viaAssetGroup)==null?void 0:S.assetGroupCode)===((m=e.toNetworkElement)==null?void 0:m.assetGroupCode)&&((c=n.viaAssetType)==null?void 0:c.assetTypeCode)===((T=e.toNetworkElement)==null?void 0:T.assetTypeCode)&&i(n.fromTerminal,e.fromNetworkElement)&&i(n.viaTerminal,e.toNetworkElement)||((D=n.viaNetworkSource)==null?void 0:D.sourceId)===((M=e.fromNetworkElement)==null?void 0:M.networkSourceId)&&((ve=n.toNetworkSource)==null?void 0:ve.sourceId)===((oe=e.toNetworkElement)==null?void 0:oe.networkSourceId)&&((k=n.viaAssetGroup)==null?void 0:k.assetGroupCode)===((j=e.fromNetworkElement)==null?void 0:j.assetGroupCode)&&((E=n.viaAssetType)==null?void 0:E.assetTypeCode)===((L=e.fromNetworkElement)==null?void 0:L.assetTypeCode)&&((V=n.toAssetGroup)==null?void 0:V.assetGroupCode)===((P=e.toNetworkElement)==null?void 0:P.assetGroupCode)&&((x=n.toAssetType)==null?void 0:x.assetTypeCode)===((Q=e.toNetworkElement)==null?void 0:Q.assetTypeCode)&&i(n.viaTerminal,e.fromNetworkElement)&&i(n.toTerminal,e.toNetworkElement):s(n,e)})}generateAddAssociations(e){return{addFeatures:e.map(t=>{var i,s,n,a,l,p;return new Bt({attributes:{fromnetworksourceid:(i=t.fromNetworkElement)==null?void 0:i.networkSourceId,fromglobalid:(s=t.fromNetworkElement)==null?void 0:s.globalId,fromterminalid:(n=t.fromNetworkElement)==null?void 0:n.terminalId,tonetworksourceid:(a=t.toNetworkElement)==null?void 0:a.networkSourceId,toglobalid:(l=t.toNetworkElement)==null?void 0:l.globalId,toterminalid:(p=t.toNetworkElement)==null?void 0:p.terminalId,associationtype:Pr[t.associationType],iscontentvisible:t.isContentVisible?1:0,percentalong:t.percentAlong,globalid:t.globalId}})}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}generateDeleteAssociations(e){return{deleteFeatures:e.map(t=>({globalId:t.globalId})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}async _loadNamedTraceConfigurationsFromNetwork(e){var s;if(((s=this.sharedNamedTraceConfigurations)==null?void 0:s.length)===0)return;const t=this.sharedNamedTraceConfigurations.map(n=>n.globalId),i=await this.queryNamedTraceConfigurations({globalIds:t},e);for(const n of this.sharedNamedTraceConfigurations){const a=i==null?void 0:i.find(l=>l.globalId===n.globalId);if(a){const l=a.write({},{origin:"service"});n.read(l,{origin:"service"})}}}async _createRulesTable(){var a;const e=this.networkSystemLayers.rulesTableUrl,t=new Or({url:e});await t.load();const i=(a=this.dataElement)==null?void 0:a.domainNetworks;if(!i)return null;const s=i.flatMap(l=>[...l.edgeSources||[],...l.junctionSources||[]]),n=(await $i(t)).map(l=>this._hydrateRuleInfo(t,s,l));return new vi({layer:t,rules:n})}_hydrateRuleInfo(e,t,i){const s=e.fieldsIndex,n=s.get("RULETYPE"),a=s.get("CREATIONDATE"),l=s.get("FROMNETWORKSOURCEID"),p=s.get("FROMASSETGROUP"),d=s.get("FROMASSETTYPE"),v=s.get("FROMTERMINALID"),b=s.get("TONETWORKSOURCEID"),I=s.get("TOASSETGROUP"),g=s.get("TOASSETTYPE"),S=s.get("TOTERMINALID"),m=s.get("VIANETWORKSOURCEID"),c=s.get("VIAASSETGROUP"),T=s.get("VIAASSETTYPE"),D=s.get("VIATERMINALID"),M=i.attributes[n.name],ve=new Date(i.attributes[a.name]),oe=[{networkSourceId:i.attributes[l.name],assetGroupId:i.attributes[p.name],assetTypeId:i.attributes[d.name],terminalId:i.attributes[v.name]},{networkSourceId:i.attributes[b.name],assetGroupId:i.attributes[I.name],assetTypeId:i.attributes[g.name],terminalId:i.attributes[S.name]},{networkSourceId:i.attributes[m.name],assetGroupId:i.attributes[c.name],assetTypeId:i.attributes[T.name],terminalId:i.attributes[D.name]}];let k;(function(E){E[E.from=0]="from",E[E.to=1]="to",E[E.via=2]="via"})(k||(k={}));const j={ruleType:M,creationDate:ve};for(const E of[k.from,k.to,k.via]){if(M!==de.RTEdgeJunctionEdgeConnectivity&&E===k.via)continue;const L=oe[E],V=t.find(se=>se.sourceId===L.networkSourceId),P=V==null?void 0:V.assetGroups.find(se=>se.assetGroupCode===L.assetGroupId),x=P==null?void 0:P.assetTypes.find(se=>se.assetTypeCode===L.assetTypeId),Q=this._getTerminal(x,L);let $="";switch(E){case k.from:$="from";break;case k.to:$="to";break;case k.via:$="via"}j[`${$}NetworkSource`]=V,j[`${$}AssetGroup`]=P,j[`${$}AssetType`]=x,j[`${$}Terminal`]=Q==null?void 0:Q.toJSON()}return j}_getTerminal(e,t){var n,a;const i=e==null?void 0:e.terminalConfigurationId,s=(n=this.terminalConfigurations)==null?void 0:n.find(l=>l.id===i);return((a=s==null?void 0:s.terminals)==null?void 0:a.find(l=>l.id===t.terminalId))??null}};async function $i(e){const t=new Tr({where:"1=1",outFields:["*"]});return(await Rr(e,t)).features}r([o({type:[bi],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],te.prototype,"sharedNamedTraceConfigurations",void 0),r([o({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],te.prototype,"type",void 0),r([o({readOnly:!0})],te.prototype,"serviceTerritoryFeatureLayerId",null),r([o({readOnly:!0})],te.prototype,"networkSystemLayers",null),r([o({readOnly:!0})],te.prototype,"terminalConfigurations",null),r([o({readOnly:!0})],te.prototype,"domainNetworkNames",null),te=r([u("esri.networks.UtilityNetwork")],te);const Kt=te,Ai=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"}));let ke=class extends B(y){constructor(t){super(t),this.expression=null,this.returnType="string",this.title=null}};r([o({type:String,json:{write:{isRequired:!0}}})],ke.prototype,"expression",void 0),r([o({type:["number","string"],json:{write:!0}})],ke.prototype,"returnType",void 0),r([o({type:String,json:{write:!0}})],ke.prototype,"title",void 0),ke=r([u("esri.webdoc.geotriggersInfo.ExpressionInfo")],ke);const Yt=ke,Ze=new Ve({deviceLocation:"device-location"});let Le=class extends B(y){constructor(t){super(t),this.filterExpression=null,this.type="device-location"}};r([o({type:Yt,json:{write:!0}})],Le.prototype,"filterExpression",void 0),r([o({type:Ze.apiValues,readOnly:!0,json:{type:Ze.jsonValues,read:Ze.read,write:Ze.write}})],Le.prototype,"type",void 0),Le=r([u("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],Le);const ki=Le;let Pe=class extends B(y){constructor(t){super(t),this.geometry=null,this.where=null}};r([o({types:jr,json:{read:Dt,write:!0}})],Pe.prototype,"geometry",void 0),r([o({type:String,json:{write:!0}})],Pe.prototype,"where",void 0),Pe=r([u("esri.webdoc.geotriggersInfo.FeatureFilter")],Pe);const xi=Pe;let xe=class extends B(y){constructor(t){super(t),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],xe.prototype,"layerId",void 0),r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],xe.prototype,"layerUrl",void 0),r([K({featureLayer:"feature-layer"},{readOnly:!0})],xe.prototype,"type",void 0),xe=r([u("esri.webdoc.geotriggersInfo.FeatureLayerSource")],xe);const Oi=xe;let me=class extends B(y){constructor(t){super(t),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};r([o({type:Oi,json:{write:{isRequired:!0}}})],me.prototype,"fenceSource",void 0),r([o({type:xi,json:{write:!0}})],me.prototype,"filter",void 0),r([o({type:Number,json:{write:!0}})],me.prototype,"bufferDistance",void 0),r([K({features:"features"},{readOnly:!0})],me.prototype,"type",void 0),me=r([u("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],me);const Ri=me;let Qe=class extends B(y){constructor(t){super(t),this.type="fence"}};r([K({fence:"fence"},{readOnly:!0})],Qe.prototype,"type",void 0),Qe=r([u("esri.webdoc.geotriggersInfo.Geotrigger")],Qe);const Qt=Qe;let Ce=class extends B(y){constructor(t){super(t),this.expressionInfo=null,this.requestedActions=null}};r([o({type:Yt,json:{write:!0}})],Ce.prototype,"expressionInfo",void 0),r([o({type:[String],json:{write:!0}})],Ce.prototype,"requestedActions",void 0),Ce=r([u("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],Ce);const Vi=Ce,Ui=new Ve({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),Li=new Ve({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),Ke=new Ve({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let G=class extends Qt{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};r([K(Ui)],G.prototype,"enterExitRule",void 0),r([o({type:ki,json:{write:{isRequired:!0}}})],G.prototype,"feed",void 0),r([K(Li)],G.prototype,"feedAccuracyMode",void 0),r([o({type:Ke.apiValues,json:{type:Ke.jsonValues,read:Ke.read,write:{writer:Ke.write,isRequired:!0}}})],G.prototype,"fenceNotificationRule",void 0),r([o({type:Ri,json:{write:{isRequired:!0}}})],G.prototype,"fenceParameters",void 0),r([o({type:String,json:{write:!0}})],G.prototype,"name",void 0),r([o({type:Vi,json:{write:!0}})],G.prototype,"notificationOptions",void 0),r([K({fence:"fence"},{readOnly:!0})],G.prototype,"type",void 0),G=r([u("esri.webdoc.geotriggersInfo.FenceGeotrigger")],G);const Pi=G,Ci={base:Qt,key:"type",typeMap:{fence:Pi}};let Xe=class extends B(y){constructor(e){super(e),this.geotriggers=null}};r([o({types:[Ci],json:{write:{isRequired:!0}}})],Xe.prototype,"geotriggers",void 0),Xe=r([u("esri.webdoc.GeotriggersInfo")],Xe);const Fi=Xe;let Oe=class extends B(y){constructor(e){super(e),this.portalItem=null}readPortalItem(e,t,i){const{itemId:s}=t;if(s)return new Ge({id:s,portal:i==null?void 0:i.portal})}writePortalItem(e,t){e!=null&&e.id&&(t.itemId=e.id)}};r([o({type:Ge,json:{write:{isRequired:!0}}})],Oe.prototype,"portalItem",void 0),r([H("portalItem",["itemId"])],Oe.prototype,"readPortalItem",null),r([R("portalItem",{itemId:{type:String}})],Oe.prototype,"writePortalItem",null),Oe=r([u("esri.webdoc.ips.PositioningService")],Oe);const Gi=Oe;let et=class extends B(y){constructor(e){super(e),this.positioningService=null}};r([o({type:Gi,json:{write:{isRequired:!0}}})],et.prototype,"positioningService",void 0),et=r([u("esri.webdoc.IPSInfo")],et);const Bi=et,Di={currentVersion:Mt,createInitialViewProperties:()=>new tt,parseVersion:Fe.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},Mi=rt.ofType(Kt);let ue=class extends ci{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}get context(){return Di}loadAll(){return Ct(this,e=>{var t,i;e(this.ground,this.basemap,this.layers,this.tables,(i=(t=this.ipsInfo)==null?void 0:t.positioningService)==null?void 0:i.portalItem)})}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new ie("webmap:empty-resource","Expected a JSON resource but got nothing")}};ue.VERSION=Mt,r([o({type:Fi,json:{write:!0}})],ue.prototype,"geotriggersInfo",void 0),r([o({type:Bi,json:{write:!0,name:"mapIPSInfo"}})],ue.prototype,"ipsInfo",void 0),r([o({json:{write:!0}})],ue.prototype,"presentation",void 0),r([o({type:Mi,json:{read:!0,write:!0}})],ue.prototype,"utilityNetworks",void 0),ue=r([u("esri.WebMap")],ue);const Ji=ue,_o=Object.freeze(Object.defineProperty({__proto__:null,default:Ji},Symbol.toStringTag,{value:"Module"}));export{_o as W,Ni as a,bi as d,yi as i,fi as s};
